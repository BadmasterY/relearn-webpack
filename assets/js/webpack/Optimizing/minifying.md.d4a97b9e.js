(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{155:function(e,a,t){"use strict";t.r(a),function(e){t.d(a,"default",(function(){return N}));var n,c=t(85),p=(t(127),t(0),t(86));function s(){return(s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function b(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},p=Object.keys(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var o,r,m=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",a)}},i=m("MdAlert"),l={};function N(e){var a=e.components,t=b(e,["components"]);return Object(p.b)("wrapper",s({},l,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h2",{className:"__internal",id:"压缩"},"压缩",Object(p.b)("a",s({parentName:"h2"},{href:"#%E5%8E%8B%E7%BC%A9","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"从 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack 4")," 开始, 默认情况下使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/terser",target:"_blank"}),"terser")," 将生产输出进行压缩。",Object(p.b)("inlineCode",{parentName:"p"},"Terser")," 是与 ",Object(p.b)("inlineCode",{parentName:"p"},"ES2015+")," 兼容的 ",Object(p.b)("inlineCode",{parentName:"p"},"JavaScript")," 压缩程序。与许多项目的早期标准 ",Object(p.b)("inlineCode",{parentName:"p"},"UglifyJS")," 相比, 它是面向未来的选择。"),Object(p.b)("p",null,"尽管 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 默认情况下会压缩输出, 但是最好了解如何自定义行为(如果要进一步调整或替换压缩工具)。"),Object(p.b)("h3",{className:"__internal",id:"压缩-javascript"},"压缩 JavaScript",Object(p.b)("a",s({parentName:"h3"},{href:"#%E5%8E%8B%E7%BC%A9-javascript","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"压缩的重点是将代码转换成更简短的形式。安全转换通过重写代码来做到这一点, 而不会破坏代码。很好的例子包括重命名变量, 甚至基于无法访问的事实删除整个代码块(",Object(p.b)("inlineCode",{parentName:"p"},"if(false)"),")。"),Object(p.b)("p",null,"不安全的转换会破坏代码, 因为它们可能会丢失底层代码所依赖的隐式内容。例如, ",Object(p.b)("inlineCode",{parentName:"p"},"Angular 1")," 在使用模块时需要特定的函数参数命名。重写参数会破坏代码, 除非在这种情况下采取预防措施。"),Object(p.b)("h3",{className:"__internal",id:"修改-javascript-压缩过程"},"修改 JavaScript 压缩过程",Object(p.b)("a",s({parentName:"h3"},{href:"#%E4%BF%AE%E6%94%B9-javascript-%E5%8E%8B%E7%BC%A9%E8%BF%87%E7%A8%8B","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"在 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 中, 压缩过程是通过两个配置字段控制的: ",Object(p.b)("inlineCode",{parentName:"p"},"optimization.minimize")," 标记用于切换和 ",Object(p.b)("inlineCode",{parentName:"p"},"optimization.minimizer")," 数组用于配置进程。"),Object(p.b)("p",null,"为了调整默认值, 我们将 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/terser-webpack-plugin",target:"_blank"}),"terser-webpack-plugin")," 附加到项目, 以便可以对其进行调整。"),Object(p.b)("p",null,"首先, 将插件安装到项目中:"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," terser-webpack-plugin --develop"))),Object(p.b)("p",null,"要将其附加到配置, 需要在 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack.parts.js")," 中添加一段函数:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"webpack.parts.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," TerserPlugin ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"terser-webpack-plugin"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\nexports",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function-variable function"}),"minifyJavaScript")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  optimization",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n    minimizer",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"new")," ",Object(p.b)("span",s({parentName:"code"},{className:"token class-name"}),"TerserPlugin"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{")," sourceMap",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token boolean"}),"true")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("p",null,"将其连接到配置文件:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"webpack.config.js")),Object(p.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," productionConfig ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"merge"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"\n",Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  parts",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"span"},{className:"token function"}),"minifyJavaScript"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")),"  ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("p",null,"如果立即执行 ",Object(p.b)("inlineCode",{parentName:"p"},"npm run build"),", 您应该会看到与以前几乎相同的结果。"),Object(p.b)(i,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"默认情况下 ",Object(p.b)("inlineCode",{parentName:"p"},"source map"),"。您可以通过 ",Object(p.b)("inlineCode",{parentName:"p"},"sourceMap")," 标志启用它们。您应该查看 ",Object(p.b)("strong",{parentName:"p"},Object(p.b)("inlineCode",{parentName:"strong"},"terser-webpack-plugin"))," 文档以了解更多选项。")),Object(p.b)(i,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"要调整 ",Object(p.b)("strong",{parentName:"p"},Object(p.b)("inlineCode",{parentName:"strong"},"Terser"))," 行为, 请将 ",Object(p.b)("inlineCode",{parentName:"p"},"terserOptions")," 与相关选项附加到插件上。")),Object(p.b)("h3",{className:"__internal",id:"使用-closure-compiler-压缩-javascript"},"使用 Closure Compiler 压缩 JavaScript",Object(p.b)("a",s({parentName:"h3"},{href:"#%E4%BD%BF%E7%94%A8-closure-compiler-%E5%8E%8B%E7%BC%A9-javascript","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/closure-webpack-plugin",target:"_blank"}),"closure-webpack-plugin")," 在底层使用 ",Object(p.b)("inlineCode",{parentName:"p"},"Google")," 的 ",Object(p.b)("inlineCode",{parentName:"p"},"Closure Compiler"),", 并行运行, 通常会得到很好的结果。"),Object(p.b)("h3",{className:"__internal",id:"加速-javascript-执行"},"加速 JavaScript 执行",Object(p.b)("a",s({parentName:"h3"},{href:"#%E5%8A%A0%E9%80%9F-javascript-%E6%89%A7%E8%A1%8C","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"特定的解决方案允许您对代码进行预处理, 以便它运行得更快。这些方案补充了压缩技术, 可以分为作用域提升、预评估和改进解析。有时, 这些技术可能会增加整个包的大小, 但是允许代码更快的执行。"),Object(p.b)("h4",{className:"__internal",id:"作用域提升"},"作用域提升",Object(p.b)("a",s({parentName:"h4"},{href:"#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%90%E5%8D%87","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"从 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack 4")," 开始, 默认情况下在生产模式下应用作用域提升。它将所有模块提升到一个作用域, 而不是为每个模块编写单独的闭包。这样做会减慢构建速度, 但会为您提供以更快速度执行的捆绑包。在 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 博客上",Object(p.b)("a",s({parentName:"p"},{href:"https://medium.com/webpack/brief-introduction-to-scope-hoisting-in-webpack-8435084c171f",target:"_blank"}),"了解有关范围提升的更多信息"),"。"),Object(p.b)(i,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"将 ",Object(p.b)("inlineCode",{parentName:"p"},"--display-optimization-bailout")," 标志传递到 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 以获得与作用域提升结果相关的调试信息。")),Object(p.b)("h4",{className:"__internal",id:"预评估"},"预评估",Object(p.b)("a",s({parentName:"h4"},{href:"#%E9%A2%84%E8%AF%84%E4%BC%B0","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/prepack-webpack-plugin",target:"_blank"}),"prepack-webpack-plugin")," 使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://prepack.io/",target:"_blank"}),"Prepack"),"(一个部分 ",Object(p.b)("inlineCode",{parentName:"p"},"JavaScript")," 评估程序)。它重写可以在编译时完成的计算, 因此可以加快代码执行速度。另请参见 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/val-loader",target:"_blank"}),"val-loader")," 和 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/babel-plugin-preval",target:"_blank"}),"babel-plugin-preval"),"。"),Object(p.b)("h3",{className:"__internal",id:"压缩-html"},"压缩 HTML",Object(p.b)("a",s({parentName:"h3"},{href:"#%E5%8E%8B%E7%BC%A9-html","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"如果您使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/html-loader",target:"_blank"}),"html-loader")," 通过代码使用 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML")," 模板, 则可以使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/posthtml-loader",target:"_blank"}),"posthtml-loader")," 通过 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/posthtml",target:"_blank"}),"posthtml")," 对其进行预处理。您可以使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/posthtml-minifier",target:"_blank"}),"posthtml-minifier")," 通过它来压缩 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML"),", 并可以使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/posthtml-minifier",target:"_blank"}),"posthtml-minify-classnames")," 来缩短类名的长度。"),Object(p.b)("h3",{className:"__internal",id:"压缩-css"},"压缩 CSS",Object(p.b)("a",s({parentName:"h3"},{href:"#%E5%8E%8B%E7%BC%A9-css","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/clean-css-loader",target:"_blank"}),"clean-css-loader")," 允许您使用流行的 ",Object(p.b)("inlineCode",{parentName:"p"},"CSS")," 压缩工具 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/clean-css",target:"_blank"}),"clean-css"),"。"),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/optimize-css-assets-webpack-plugin",target:"_blank"}),"optimize-css-assets-webpack-plugin")," 是一个基于插件的选项, 它在 ",Object(p.b)("inlineCode",{parentName:"p"},"CSS")," 资源上应用所选的压缩工具。使用 ",Object(p.b)("inlineCode",{parentName:"p"},"minicsSextTrackPlugin")," 可能导致 ",Object(p.b)("inlineCode",{parentName:"p"},"CSS")," 重复, 因为它只合并代码块。",Object(p.b)("inlineCode",{parentName:"p"},"OptimizeCSSAssetsPlugin")," 通过对生成的结果进行操作来避免这个问题, 从而可以获得更好的结果。"),Object(p.b)("h4",{className:"__internal",id:"配置-css-压缩"},"配置 CSS 压缩",Object(p.b)("a",s({parentName:"h4"},{href:"#%E9%85%8D%E7%BD%AE-css-%E5%8E%8B%E7%BC%A9","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"在可用的解决方案中, ",Object(p.b)("inlineCode",{parentName:"p"},"OptimizeCSSAssetsPlugin")," 是最灵活的一种, 使用它可以将其他软件包与 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 连接。要将其附加到配置文件中, 请先安装插件和 ",Object(p.b)("a",s({parentName:"p"},{href:"http://cssnano.co/",target:"_blank"}),"cssnano"),":"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," optimize-css-assets-webpack-plugin cssnano --develop"))),Object(p.b)("p",null,"像 ",Object(p.b)("inlineCode",{parentName:"p"},"JavaScript")," 一样, 您可以将其包装在 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack.parts.js")," 的一个函数中:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"webpack.parts.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," OptimizeCSSAssetsPlugin ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"optimize-css-assets-webpack-plugin"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," cssnano ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"cssnano"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\nexports",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function-variable function"}),"minifyCSS")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"{")," options ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"}")),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  plugins",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"new")," ",Object(p.b)("span",s({parentName:"code"},{className:"token class-name"}),"OptimizeCSSAssetsPlugin"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n      cssProcessor",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," cssnano",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n      cssProcessorOptions",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," options",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n      canPrint",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token boolean"}),"false"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)(i,s({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"如果像",Object(p.b)("a",s({parentName:"p"},{href:"../Optimizing/build-analysis"}),'"构建分析"'),"一章中所讨论的那样将 ",Object(p.b)("inlineCode",{parentName:"p"},"--json")," 输出与 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 一起使用, 那么应该为插件设置 ",Object(p.b)("inlineCode",{parentName:"p"},"canPrint: false"),"。")),Object(p.b)("p",null,"将函数连接到配置文件:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"webpack.config.js")),Object(p.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," productionConfig ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"merge"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),"\n  parts",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"minifyJavaScript"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  parts",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"span"},{className:"token function"}),"minifyCSS"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"{")),Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"    options",Object(p.b)("span",s({parentName:"span"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"{")),Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"      preset",Object(p.b)("span",s({parentName:"span"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"["),Object(p.b)("span",s({parentName:"span"},{className:"token string"}),'"default"'),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")),Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"    ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")),Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")),"  ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("p",null,"如果您现在构建项目(",Object(p.b)("inlineCode",{parentName:"p"},"npm run build"),"), 您应该注意到 ",Object(p.b)("inlineCode",{parentName:"p"},"CSS")," 已经变小了, 因为移除了注释, 并且已经进行了压缩:"),Object(p.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),"⬡ webpack: Build Finished\n⬡ webpack: Hash: c205c9aaa067750f6e79\n  Version: webpack ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"5.0"),".0-beta.29\n  Time: ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"11809")," ms\n  Built at: ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"2020"),"-09-22 ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"14"),":46:59\n  asset ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"34"),".js ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"196")," bytes ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"emitted",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"minimized",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"1")," related asset\n  asset ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"728"),".js ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"139")," KiB ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"emitted",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"minimized",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"id hint: vendors",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"2")," related assets\n  asset index.html ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"267")," bytes ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"emitted",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),"\n  asset logo.jpg ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"515")," KiB ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"emitted",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"big",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"auxiliary name: main",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  asset main.css ",Object(p.b)("span",s({parentName:"span"},{className:"token number"}),"1.14")," KiB ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"["),"emitted",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"("),"name: main",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),")")),"  asset main.js ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"2.89")," KiB ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"emitted",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"minimized",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"name: main",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"1")," related asset\n  Entrypoint main ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"728"),".js main.css main.js ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"728"),".js.map logo.jpg main.js.map",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),".."),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),".."),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"..")))),Object(p.b)(i,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/compression-webpack-plugin",target:"_blank"}),"compression-webpack-plugin")," 允许您将生成压缩文件的问题推送到 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack"),", 以潜在地节省服务器上的处理时间。")),Object(p.b)(i,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"使用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/last-call-webpack-plugin",target:"_blank"}),"last-call-webpack-plugin")," 是一种更通用的方法, 您可以使用它来定义在 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 完成处理之前针对哪种文件格式使用哪种处理。")),Object(p.b)("h3",{className:"__internal",id:"压缩捆绑包"},"压缩捆绑包",Object(p.b)("a",s({parentName:"h3"},{href:"#%E5%8E%8B%E7%BC%A9%E6%8D%86%E7%BB%91%E5%8C%85","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"压缩技术, 如 ",Object(p.b)("inlineCode",{parentName:"p"},"gzip")," 或 ",Object(p.b)("inlineCode",{parentName:"p"},"brotli"),", 可以用来进一步减小文件大小。使用额外压缩的缺点是, 它将导致客户端进行额外的计算, 但从好的方面来说, 您可以节省带宽。通常, 压缩设置可以在服务器端完成, 当然, 也可以使用以下插件使用 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 执行预处理:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/compression-webpack-plugin",target:"_blank"}),"compression-webpack-plugin")," 是一个通用压缩插件, 可让您在多个选项中进行选择"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/brotli-webpack-plugin",target:"_blank"}),"brotli-webpack-plugin")," 专门用于 ",Object(p.b)("inlineCode",{parentName:"li"},"brotli"),"。")),Object(p.b)("h3",{className:"__internal",id:"混淆输出"},"混淆输出",Object(p.b)("a",s({parentName:"h3"},{href:"#%E6%B7%B7%E6%B7%86%E8%BE%93%E5%87%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"为了使第三方更难以阅读您的代码, 可以应用 ",Object(p.b)("a",s({parentName:"p"},{href:"https://github.com/javascript-obfuscator/obfuscator-loader",target:"_blank"}),"obfuscator-loader"),"。尽管在与客户端共享时很难保护代码, 但是可以使代码更难阅读。"),Object(p.b)("h3",{className:"__internal",id:"结论"},"结论",Object(p.b)("a",s({parentName:"h3"},{href:"#%E7%BB%93%E8%AE%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"压缩是使捆绑包体积变小的最佳方式。回顾一下:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"如果使用安全转换, 压缩过程将分析您的源代码并将其转换为具有相同含义的简短形式。特定的不安全转换使您可以获得体积更小的结果, 同时可能破坏底层依赖于特定参数命名的代码。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("inlineCode",{parentName:"li"},"Webpack")," 默认在生产模式下使用 ",Object(p.b)("inlineCode",{parentName:"li"},"Terser")," 执行压缩。其他解决方案(例如 ",Object(p.b)("inlineCode",{parentName:"li"},"Google")," 的 ",Object(p.b)("inlineCode",{parentName:"li"},"Closure Compiler"),")提供了类似的功能, 但需要自己进行配置。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"除了 ",Object(p.b)("inlineCode",{parentName:"li"},"JavaScript"),", 还可以压缩其他资源, 例如 ",Object(p.b)("inlineCode",{parentName:"li"},"CSS")," 和 ",Object(p.b)("inlineCode",{parentName:"li"},"HTML"),"。压缩这些要求使用特定的技术, 这些技术必须通过自己的加载器和插件来应用。")),Object(p.b)("p",null,"在下一章中, 您将学习对代码应用 ",Object(p.b)("inlineCode",{parentName:"p"},"tree shaking"),"。"))}N.isMDXComponent=!0,N=Object(c.hot)(e)(N),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(o.register(m,"makeShortcode","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Optimizing/minifying.md"),o.register(i,"MdAlert","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Optimizing/minifying.md"),o.register(l,"layoutProps","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Optimizing/minifying.md"),o.register("wrapper","MDXLayout","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Optimizing/minifying.md"),o.register(N,"MDXContent","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Optimizing/minifying.md")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)}.call(this,t(21)(e))}}]);