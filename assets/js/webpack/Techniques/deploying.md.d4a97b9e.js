(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{169:function(e,a,t){"use strict";t.r(a),function(e){t.d(a,"default",(function(){return N}));var n,p=t(85),c=(t(127),t(0),t(86));function b(){return(b=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function s(e,a){if(null==e)return{};var t,n,p=function(e,a){if(null==e)return{};var t,n,p={},c=Object.keys(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||(p[t]=e[t]);return p}(e,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(p[t]=e[t])}return p}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var o,r,l=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(c.b)("div",a)}},i=l("MdAlert"),m={};function N(e){var a=e.components,t=s(e,["components"]);return Object(c.b)("wrapper",b({},m,t,{components:a,mdxType:"MDXLayout"}),Object(c.b)("h2",{className:"__internal",id:"部署应用"},"部署应用",Object(c.b)("a",b({parentName:"h2"},{href:"#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"使用 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的项目可以部署到各种环境中。一个不依赖后端的公共项目可以使用 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"gh-pages"))," 将其推到 ",Object(c.b)("inlineCode",{parentName:"p"},"GitHub Pages"),"。此外还有各种各样的 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 插件可以针对其他环境, 如 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"S3")),"。"),Object(c.b)("h3",{className:"__internal",id:"使用-gh-pages-部署"},"使用 gh-pages 部署",Object(c.b)("a",b({parentName:"h3"},{href:"#%E4%BD%BF%E7%94%A8-gh-pages-%E9%83%A8%E7%BD%B2","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/gh-pages",target:"_blank"}),"gh-pages")," 允许您轻松在 ",Object(c.b)("inlineCode",{parentName:"p"},"GitHub Pages")," 上托管独立应用程序。首先必须指向构建目录。它获取内容并将其推送到 ",Object(c.b)("inlineCode",{parentName:"p"},"gh-pages")," 分支。"),Object(c.b)("p",null,"不管它的名字是什么, 该软件包都可与其他 ",Object(c.b)("inlineCode",{parentName:"p"},"Git")," 存储库托管服务一起使用。但是, 鉴于 ",Object(c.b)("inlineCode",{parentName:"p"},"GitHub"),' 非常有名, 它可以用来演示这个想法。在实践中, 您可能需要进行更复杂的设置, 这将通过"持续集成"系统将结果推送到另一服务。'),Object(c.b)("h4",{className:"__internal",id:"设置-gh-pages"},"设置 gh-pages",Object(c.b)("a",b({parentName:"h4"},{href:"#%E8%AE%BE%E7%BD%AE-gh-pages","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"首先, 执行:"),Object(c.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(c.b)("pre",b({parentName:"div"},{className:"language-bash"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-bash"}),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"npm")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"add")," gh-pages --develop"))),Object(c.b)("p",null,"您还将需要以下 ",Object(c.b)("inlineCode",{parentName:"p"},"package.json")," 脚本:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"package.json")),Object(c.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"json"},Object(c.b)("pre",b({parentName:"div"},{className:"language-json"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-json"}),Object(c.b)("span",b({parentName:"code"},{className:"token property"}),'"scripts"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  ",Object(c.b)("span",b({parentName:"span"},{className:"token property"}),'"deploy"'),Object(c.b)("span",b({parentName:"span"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"span"},{className:"token string"}),'"gh-pages -d dist"'),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")),"  ......\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")))),Object(c.b)("p",null,"为了确保资源路径在 ",Object(c.b)("inlineCode",{parentName:"p"},"GitHub")," 上可以正常工作, 必须调整 ",Object(c.b)("inlineCode",{parentName:"p"},"output.publicPath")," 字段。否则, 资源路径最终会指向根目录, 除非直接在域根目录之后进行托管(例如: ",Object(c.b)("inlineCode",{parentName:"p"},"survivejs.com"),"), 否则资源路径将不起作用。"),Object(c.b)("p",null,"例如, 可以通过调整 ",Object(c.b)("inlineCode",{parentName:"p"},"publicPath")," 控制您在 ",Object(c.b)("inlineCode",{parentName:"p"},"index.html")," 上看到的 ",Object(c.b)("inlineCode",{parentName:"p"},"URL")," 结果 。如果您将资产托管在 ",Object(c.b)("inlineCode",{parentName:"p"},"CDN")," 上, 则可以进行调整。"),Object(c.b)("p",null,"在这种情况下, 将其设置为指向 ",Object(c.b)("inlineCode",{parentName:"p"},"GitHub")," 项目就足够了, 如下所示:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"webpack.config.js")),Object(c.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"const")," productionConfig ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"merge"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n    output",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n      ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"      ",Object(c.b)("span",b({parentName:"span"},{className:"token comment"}),"// // Needed for code splitting to work in nested paths")),Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"      ",Object(c.b)("span",b({parentName:"span"},{className:"token comment"}),'// publicPath: "/",')),"\n",Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"      ",Object(c.b)("span",b({parentName:"span"},{className:"token comment"}),"// Tweak this to match your GitHub project name")),Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"      publicPath",Object(c.b)("span",b({parentName:"span"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"span"},{className:"token string"}),'"/webpack-demo/"'),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")),"    ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";")))),Object(c.b)("p",null,"构建(",Object(c.b)("inlineCode",{parentName:"p"},"npm run build"),")和部署(",Object(c.b)("inlineCode",{parentName:"p"},"npm run deploy"),")之后, 您应该从 ",Object(c.b)("inlineCode",{parentName:"p"},"GitHub Pages")," 上托管的 ",Object(c.b)("inlineCode",{parentName:"p"},"dist/")," 目录中获取应用程序。假设一切正常应该可以在 ",Object(c.b)("inlineCode",{parentName:"p"},"https://<name>.github.io/<project>")," 找到它。"),Object(c.b)(i,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"如果您需要更详细的设置, 请使用 ",Object(c.b)("inlineCode",{parentName:"p"},"gh-pages")," 提供的 ",Object(c.b)("inlineCode",{parentName:"p"},"Node API"),"。但是, 它提供的默认命令行工具足以满足基本需求。")),Object(c.b)(i,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("inlineCode",{parentName:"p"},"GitHub Pages")," 允许您选择要部署的分支。即使对于不需要捆绑的小型网站, 也可以使用 ",Object(c.b)("inlineCode",{parentName:"p"},"master")," 分支。您也可以指向 ",Object(c.b)("inlineCode",{parentName:"p"},"master")," 分支中的 ",Object(c.b)("inlineCode",{parentName:"p"},"./docs")," 目录下并维护站点。")),Object(c.b)("blockquote",null,Object(c.b)("p",{parentName:"blockquote"},Object(c.b)("strong",{parentName:"p"},"BTW"),": 现在 ",Object(c.b)("inlineCode",{parentName:"p"},"Github")," 新建项目的默认分支为 ",Object(c.b)("inlineCode",{parentName:"p"},"main"),", 不再使用 ",Object(c.b)("inlineCode",{parentName:"p"},"master")," 作为默认分支的名称。")),Object(c.b)("h4",{className:"__internal",id:"存档旧版本"},"存档旧版本",Object(c.b)("a",b({parentName:"h4"},{href:"#%E5%AD%98%E6%A1%A3%E6%97%A7%E7%89%88%E6%9C%AC","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"gh-pages")," 提供了用于存档目的的 ",Object(c.b)("inlineCode",{parentName:"p"},"add")," 选项。这个想法如下:"),Object(c.b)("ol",null,Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"将站点的旧版本复制到临时目录中, 然后从中删除 ",Object(c.b)("inlineCode",{parentName:"li"},"archive")," 目录。您可以根据需要命名 ",Object(c.b)("inlineCode",{parentName:"li"},"archive")," 目录。"),Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"清理并构建项目。"),Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"将旧版本复制到 ",Object(c.b)("inlineCode",{parentName:"li"},"dist/archive/_")," 下。"),Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"设置 ",Object(c.b)("inlineCode",{parentName:"li"},"Node")," 脚本以通过如下调用 ",Object(c.b)("inlineCode",{parentName:"li"},"gh-pages")," 并捕获回调中可能的错误:",Object(c.b)("div",b({parentName:"li"},{className:"rcpress-highlight","data-language":"js"}),Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"})," ghpages",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"publish"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"path",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"join"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"dist"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{")," add",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token boolean"}),"true")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," cb",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";")))))),Object(c.b)("h3",{className:"__internal",id:"部署到其他环境"},"部署到其他环境",Object(c.b)("a",b({parentName:"h3"},{href:"#%E9%83%A8%E7%BD%B2%E5%88%B0%E5%85%B6%E4%BB%96%E7%8E%AF%E5%A2%83","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"尽管可以将部署问题推到 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 之外, 但有几个特定于 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的实用工具可以派上用场:"),Object(c.b)("ul",null,Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/webpack-deploy",target:"_blank"}),"webpack-deploy")," 是部署应用程序的集合, 甚至可以在 ",Object(c.b)("inlineCode",{parentName:"li"},"webpack")," 之外工作。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/webpack-s3-sync-plugin",target:"_blank"}),"webpack-s3-sync-plugin")," 和 ",Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/webpack-s3-plugin",target:"_blank"}),"webpack-s3-plugin")," 将资源同步到 ",Object(c.b)("inlineCode",{parentName:"li"},"Amazon"),"。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/ssh-webpack-plugin",target:"_blank"}),"ssh-webpack-plugin")," 专为通过 ",Object(c.b)("inlineCode",{parentName:"li"},"SSH")," 进行部署而设计。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/now-loader",target:"_blank"}),"now-loader")," 在资源级别上运行, 并允许将特定资源部署到 ",Object(c.b)("inlineCode",{parentName:"li"},"Now")," 托管服务。")),Object(c.b)(i,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"要访问生成的文件及其路径, 请考虑使用 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/assets-webpack-plugin",target:"_blank"}),"assets-webpack-plugin"),"。路径信息使您可以在部署时将 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 与其他环境集成。")),Object(c.b)(i,b({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"为确保依赖较旧捆绑软件的客户端在部署新版本后仍能正常工作, 请不要删除旧文件, 直到它们确实不再使用时。您可以对部署时要删除的内容进行特定检查, 而不是删除所有旧资源。")),Object(c.b)("h3",{className:"__internal",id:"动态解析-outputpublicpath"},"动态解析 output.publicPath",Object(c.b)("a",b({parentName:"h3"},{href:"#%E5%8A%A8%E6%80%81%E8%A7%A3%E6%9E%90-outputpublicpath","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"如果您事先不知道 ",Object(c.b)("inlineCode",{parentName:"p"},"publicPath"),", 可以按照以下步骤根据环境进行解决:"),Object(c.b)("ol",null,Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"在应用程序的入口设置 ",Object(c.b)("inlineCode",{parentName:"li"},"__webpack_public_path__ = window.myDynamicPublicPath;")," 并根据合适的方式解析它。"),Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"从 ",Object(c.b)("inlineCode",{parentName:"li"},"webpack")," 配置中删除 ",Object(c.b)("inlineCode",{parentName:"li"},"output.publicPath"),"。"),Object(c.b)("li",b({parentName:"ol"},{className:"__internal"}),"如果使用 ",Object(c.b)("inlineCode",{parentName:"li"},"ESLint"),", 将其设置为 ",Object(c.b)("inlineCode",{parentName:"li"},"globals.__webpack_public_path__:true")," 忽略全局。")),Object(c.b)("p",null,"编译时, ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 会查找 ",Object(c.b)("inlineCode",{parentName:"p"},"__webpack_public_path__")," 并重写它, 以便它指向 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 逻辑。"),Object(c.b)(i,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"有关在模块级别可用的其他特定于 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的变量, 请参见 ",Object(c.b)("a",b({parentName:"p"},{href:"https://webpack.js.org/api/module-variables/",target:"_blank"}),"webpack 文档"),"。")),Object(c.b)("h3",{className:"__internal",id:"结论"},"结论",Object(c.b)("a",b({parentName:"h3"},{href:"#%E7%BB%93%E8%AE%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"即使 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 不是部署工具, 您也可以找到部署相关的插件。"),Object(c.b)("p",null,"回顾一下:"),Object(c.b)("ul",null,Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),"可以处理 ",Object(c.b)("inlineCode",{parentName:"li"},"Webpack")," 之外的部署问题。例如, 您可以在 ",Object(c.b)("inlineCode",{parentName:"li"},"npm")," 脚本中实现此目的。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),"您可以动态配置 ",Object(c.b)("inlineCode",{parentName:"li"},"webpack")," 的 ",Object(c.b)("inlineCode",{parentName:"li"},"output.publicPath")," 。如果您不知道编译时间并想稍后再决定, 则此技术非常有用。这是可以通过 ",Object(c.b)("inlineCode",{parentName:"li"},"globals.__webpack_public_path__")," 实现。")))}N.isMDXComponent=!0,N=Object(p.hot)(e)(N),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(o.register(l,"makeShortcode","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/deploying.md"),o.register(i,"MdAlert","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/deploying.md"),o.register(m,"layoutProps","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/deploying.md"),o.register("wrapper","MDXLayout","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/deploying.md"),o.register(N,"MDXContent","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/deploying.md")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)}.call(this,t(21)(e))}}]);