(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{172:function(e,a,t){"use strict";t.r(a),function(e){t.d(a,"default",(function(){return i}));var n,c=t(85),p=(t(127),t(0),t(86));function s(){return(s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function o(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},p=Object.keys(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(n=0;n<p.length;n++)t=p[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var b,r,m=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",a)}},l=m("MdAlert"),N={};function i(e){var a=e.components,t=o(e,["components"]);return Object(p.b)("wrapper",s({},N,t,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h2",{className:"__internal",id:"测试"},"测试",Object(p.b)("a",s({parentName:"h2"},{href:"#%E6%B5%8B%E8%AF%95","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"测试是开发的重要组成部分。即使诸如 ",Object(p.b)("inlineCode",{parentName:"p"},"linting")," 之类的技术可以帮助发现并解决问题, 但它们也有其局限性。测试可以在许多不同级别上应用于代码和应用程​​序。"),Object(p.b)("p",null,"您可以对特定代码段进行",Object(p.b)("strong",{parentName:"p"},"单元测试"),", 也可以通过",Object(p.b)("strong",{parentName:"p"},"验收测试"),"从用户的角度查看应用程序。",Object(p.b)("strong",{parentName:"p"},"集成测试"),"适用于这两个极端, 并且关注单独的代码单元如何一起运行。"),Object(p.b)("p",null,"通常, 您不需要 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 即可运行测试。",Object(p.b)("a",s({parentName:"p"},{href:"https://jestjs.io/",target:"_blank"}),"Jest"),", ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.cypress.io/",target:"_blank"}),"Cypress")," 和 ",Object(p.b)("a",s({parentName:"p"},{href:"https://pptr.dev/",target:"_blank"}),"Puppeteer")," 之类的工具很好地解决了这个问题。如果您在代码中使用 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 功能, 通常有多种方法可以适用于 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 的特定语法。"),Object(p.b)("p",null,"在本章中, 您将看到几种使用 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 运行测试工具的方法, 因为这仍然是使您受益于 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 特定功能的一种选择。"),Object(p.b)("h3",{className:"__internal",id:"mocha"},"Mocha",Object(p.b)("a",s({parentName:"h3"},{href:"#mocha","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://mochajs.org/",target:"_blank"}),"Mocha")," 是 ",Object(p.b)("inlineCode",{parentName:"p"},"Node")," 的流行测试框架。尽管 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 提供了测试基础结构, 但您必须对其进行声明。即使 ",Object(p.b)("inlineCode",{parentName:"p"},"Node")," 的 ",Object(p.b)("a",s({parentName:"p"},{href:"https://nodejs.org/api/assert.html",target:"_blank"}),"assert")," 足够了, 但它也可以与其他断言库一起使用。",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/mocha-loader",target:"_blank"}),"mocha-loader")," 允许通过 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 运行 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 测试。"),Object(p.b)("h4",{className:"__internal",id:"使用-webpack-配置-mocha-loader"},"使用 webpack 配置 mocha-loader",Object(p.b)("a",s({parentName:"h4"},{href:"#%E4%BD%BF%E7%94%A8-webpack-%E9%85%8D%E7%BD%AE-mocha-loader","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"首先, 将 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 和 ",Object(p.b)("inlineCode",{parentName:"p"},"mocha-loader")," 安装到您的项目中:"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," mocha mocha-loader --develop"))),Object(p.b)("h4",{className:"__internal",id:"设置代码进行测试"},"设置代码进行测试",Object(p.b)("a",s({parentName:"h4"},{href:"#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"要进行测试, 请添加一个用于测试的功能:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"tests/add.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),"module",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function-variable function"}),"exports")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),"a",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")," b"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>")," a ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"+")," b",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("p",null,"然后, 要进行测试, 请添加一个小型测试套件:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"tests/add.test.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," assert ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"assert"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," add ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"./add"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"describe"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"Demo"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"it"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"should add correctly"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n    assert",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"equal"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"1"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"1"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"2"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("h4",{className:"__internal",id:"配置-mocha"},"配置 Mocha",Object(p.b)("a",s({parentName:"h4"},{href:"#%E9%85%8D%E7%BD%AE-mocha","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"要使用 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 运行测试, 请添加脚本:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"package.json")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"json"},Object(p.b)("pre",s({parentName:"div"},{className:"language-json"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-json"}),Object(p.b)("span",s({parentName:"code"},{className:"token property"}),'"scripts"'),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token property"}),'"test:mocha"'),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"mocha tests"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ......\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")))),Object(p.b)("p",null,"如果立即执行 ",Object(p.b)("inlineCode",{parentName:"p"},"npm run test:mocha"),", 应该会看到以下输出:"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),"Demo\n  should ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," correctly\n\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"1")," passing ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"5ms",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")))),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 还提供了一种 ",Object(p.b)("inlineCode",{parentName:"p"},"watch")," 模式, 您可以通过 ",Object(p.b)("inlineCode",{parentName:"p"},"npm run test:mocha -- --watch")," 激活该模式。修改代码时, 它将自动运行测试套件。"),Object(p.b)(l,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"如果您只想关注一组特定的测试, 则可使用 ",Object(p.b)("inlineCode",{parentName:"p"},"--grep <pattern>")," 约束行为。")),Object(p.b)("h4",{className:"__internal",id:"配置-webpack"},"配置 webpack",Object(p.b)("a",s({parentName:"h4"},{href:"#%E9%85%8D%E7%BD%AE-webpack","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Webpack")," 可以通过 ",Object(p.b)("inlineCode",{parentName:"p"},"web")," 界面提供类似的功能。本书前面的章节已经解决了问题的难点。剩下的就是通过配置将这些解决方案结合起来。"),Object(p.b)("p",null,"要告诉 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 运行哪些测试, 需要以某种方式将其导入。",Object(p.b)("a",s({parentName:"p"},{href:"./dynamic-loading"}),'"动态加载"')," 一章中讨论的 ",Object(p.b)("inlineCode",{parentName:"p"},"require.context"),", 允许根据规则组合文件, 用在这里非常理想。"),Object(p.b)("p",null,"设置入口文件如下:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"tests/index.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token comment"}),"// Skip execution in Node"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"if")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"module",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"hot",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," context ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," require",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"context"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"mocha-loader!./"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token comment"}),"// Process through mocha-loader"),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token boolean"}),"false"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token comment"}),"// Skip recursive processing"),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"/"),"\\",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"test",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"js$",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"/")," ",Object(p.b)("span",s({parentName:"code"},{className:"token comment"}),"// Pick only files ending with .test.js"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token comment"}),"// Execute each test suite"),"\n  context",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"keys"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"forEach"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"context",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")))),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Webpack")," 配置中需要进行一些小的更改:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"webpack.mocha.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," path ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"path"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{")," merge ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"webpack-merge"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," parts ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"./webpack.parts"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\nmodule",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"exports ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"merge"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n    mode",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"development"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  parts",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"devServer"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  parts",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"page"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n    title",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"Mocha demo"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    entry",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n      tests",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," path",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"join"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"tests"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)(l,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"有关完整配置, 请参见",Object(p.b)("a",s({parentName:"p"},{href:"../Developing/composing-configuration"}),'"组合配置"'),"一章中的 ",Object(p.b)("inlineCode",{parentName:"p"},"devServer"),"。页面配置在",Object(p.b)("a",s({parentName:"p"},{href:"../Output/multiple-pages"}),'"多页"'),"一章中进行了说明。")),Object(p.b)("p",null,"添加脚本以使其方便运行:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"package.json")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"json"},Object(p.b)("pre",s({parentName:"div"},{className:"language-json"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-json"}),Object(p.b)("span",s({parentName:"code"},{className:"token property"}),'"scripts"'),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token property"}),'"test:mocha:watch"'),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"wp --config webpack.mocha.js"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ......\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")))),Object(p.b)(l,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"如果您想了解为什么 ",Object(p.b)("inlineCode",{parentName:"p"},"--hot")," 更好, 请参阅",Object(p.b)("a",s({parentName:"p"},{href:"../Appendices/hmr"}),'"模块热更新"'),"附录。")),Object(p.b)("p",null,"如果您现在执行 ",Object(p.b)("inlineCode",{parentName:"p"},"npm run test:mocha:watch")," 并导航到 ",Object(p.b)("inlineCode",{parentName:"p"},"http://localhost:8080/"),", 则应该看到测试信息:\n",Object(p.b)("img",s({parentName:"p"},{src:"../../techniques/mocha.png",alt:"浏览器中的 Mocha"}))),Object(p.b)("p",null,"调整测试或代码将导致浏览器发生变化。您可以在查看测试状态的同时增加代码规模或重构代码。"),Object(p.b)("p",null,"与普通的 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 设置相比, 通过 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 配置 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 具有以下优点:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"可以调整模块分辨率。",Object(p.b)("inlineCode",{parentName:"li"},"Webpack")," 别名和其他技术现在可以解决将代码绑定到 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 的警告。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"您可以根据需要使用 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 的处理来编译代码。如果使用 ",Object(p.b)("inlineCode",{parentName:"li"},"Mocha"),", 则意味着需要进行更多设置。缺点是, 现在您需要一个浏览器来检查测试。")),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"mocha-loader")," 最好地开发助手。通过无头浏览器运行测试可以解决该问题。"),Object(p.b)("h3",{className:"__internal",id:"jest"},"Jest",Object(p.b)("a",s({parentName:"h3"},{href:"#jest","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Facebook")," 的 ",Object(p.b)("a",s({parentName:"p"},{href:"https://facebook.github.io/jest/",target:"_blank"}),"Jest")," 是一个固执己见的替代方案, 它以最小的配置封装了功能, 包括 ",Object(p.b)("inlineCode",{parentName:"p"},"coverage")," 和 ",Object(p.b)("inlineCode",{parentName:"p"},"mocking"),"。它可以捕获数据的快照, 从而使其对于您想要记录和保留其行为的项目很有价值。"),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Jest")," 遵循 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/jasmine",target:"_blank"}),"Jasmine")," 测试框架语义, 它支持 ",Object(p.b)("inlineCode",{parentName:"p"},"Jasmine")," 风格的断言。尤其是套件定义非常接近 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha"),", 因此当前的测试代码应该可以在无修改的情况下进测试工作。",Object(p.b)("inlineCode",{parentName:"p"},"Jest")," 提供了 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/jest-codemods",target:"_blank"}),"jest-codemods"),", 用于将更复杂的项目迁移到 ",Object(p.b)("inlineCode",{parentName:"p"},"Jest")," 语义。"),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Jest")," 通过 ",Object(p.b)("a",s({parentName:"p"},{href:"https://facebook.github.io/jest/docs/en/configuration.html",target:"_blank"}),"package.json 配置")," 捕获测试。它自动在 ",Object(p.b)("inlineCode",{parentName:"p"},"tests")," 目录中检测测试。要捕获测试覆盖率信息, 必须在 ",Object(p.b)("inlineCode",{parentName:"p"},"package.json")," 中的将 ",Object(p.b)("inlineCode",{parentName:"p"},"jest")," 设置为 ",Object(p.b)("inlineCode",{parentName:"p"},'"collectCoverage": true')," 或者把 ",Object(p.b)("inlineCode",{parentName:"p"},"--coverage")," 标志传给 ",Object(p.b)("inlineCode",{parentName:"p"},"Jest"),"。默认情况下, 它在 ",Object(p.b)("inlineCode",{parentName:"p"},"coverage")," 目录下发出 ",Object(p.b)("inlineCode",{parentName:"p"},"coverage")," 报告。"),Object(p.b)("p",null,"将一个 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 设置移植到 ",Object(p.b)("inlineCode",{parentName:"p"},"Jest")," 需要更多的工作, 尤其是当您依赖于 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 特定的特性时。",Object(p.b)("a",s({parentName:"p"},{href:"https://jestjs.io/docs/en/webpack.html",target:"_blank"}),"官方指南"),"涵盖了相当多的常见问题。您可以通过 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/babel-jest",target:"_blank"}),"babel-jest")," 配置 ",Object(p.b)("inlineCode",{parentName:"p"},"Jest")," 来使用 ",Object(p.b)("inlineCode",{parentName:"p"},"Babel"),", 因为它允许您使用 ",Object(p.b)("inlineCode",{parentName:"p"},"Babel")," 插件(例如: ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/babel-plugin-module-resolver",target:"_blank"}),"babel-plugin-module-resolver"),")来匹配 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 的功能。"),Object(p.b)("h3",{className:"__internal",id:"ava"},"AVA",Object(p.b)("a",s({parentName:"h3"},{href:"#ava","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/ava",target:"_blank"}),"AVA")," 是设计旨在利用并行执行的测试运行程序。它具备自己的测试套件定义。",Object(p.b)("a",s({parentName:"p"},{href:"https://github.com/greyepoxy/webpack-ava-recipe",target:"_blank"}),"webpack-ava-recipe")," 介绍了如何将其与 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 连接。"),Object(p.b)("p",null,"主要思想是在 ",Object(p.b)("inlineCode",{parentName:"p"},"watch")," 模式下运行 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 和 ",Object(p.b)("inlineCode",{parentName:"p"},"AVA"),", 以将处理代码的问题推送到 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack"),", 同时允许 ",Object(p.b)("inlineCode",{parentName:"p"},"AVA")," 使用已处理的代码。",Object(p.b)("inlineCode",{parentName:"p"},"require.context")," 与 ",Object(p.b)("inlineCode",{parentName:"p"},"Mocha")," 讨论的想法在这里非常有用, 因为您必须捕获 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 的测试才能以某种方式进行处理。"),Object(p.b)("h3",{className:"__internal",id:"从测试中删除文件"},"从测试中删除文件",Object(p.b)("a",s({parentName:"h3"},{href:"#%E4%BB%8E%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"如果通过 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 执行测试, 可能想要改变它对待图片等资源的方式。可以通过正则匹配它们, 然后使用 ",Object(p.b)("inlineCode",{parentName:"p"},"noop")," 函数来替换模块, 如下所示:"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),"plugins",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"new")," ",Object(p.b)("span",s({parentName:"code"},{className:"token class-name"}),"webpack",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),"NormalModuleReplacementPlugin"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token regex"}),"/\\.(gif|png|scss|css)$/"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"lodash/noop"'),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("h3",{className:"__internal",id:"mocking"},"Mocking",Object(p.b)("a",s({parentName:"h3"},{href:"#mocking","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"Mocking")," 是一种可以替换测试对象的技术。考虑下面的解决方案:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/sinon",target:"_blank"}),"Sinon")," 提供 ",Object(p.b)("inlineCode",{parentName:"li"},"mocks"),", ",Object(p.b)("inlineCode",{parentName:"li"},"stubs")," 和 ",Object(p.b)("inlineCode",{parentName:"li"},"spies"),"。",Object(p.b)("inlineCode",{parentName:"li"},"Sinon")," 与 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 一起运行良好。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/inject-loader",target:"_blank"}),"inject-loader")," 允许通过依赖关系将代码注入到模块中, 这使得它对于 ",Object(p.b)("inlineCode",{parentName:"li"},"mocking")," 很有价值。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/webpack-inject-plugin",target:"_blank"}),"webpack-inject-plugin")," 用于在捆绑级别注入代码的插件。")),Object(p.b)("h3",{className:"__internal",id:"结论"},"结论",Object(p.b)("a",s({parentName:"h3"},{href:"#%E7%BB%93%E8%AE%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"可以将 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 配置与多种测试工具一起使用。每种工具都有其优点, 但是它们也有很多共同点。"),Object(p.b)("p",null,"回顾一下:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"运行测试工具使您可以受益于 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 的模块解析机制。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"有时测试设置可能会涉及很多样板。像 ",Object(p.b)("inlineCode",{parentName:"li"},"Jest")," 这样的工具可以删除大部分样板, 并允许您以最少的配置来开发测试。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"您可以找到多个用于 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 的 ",Object(p.b)("inlineCode",{parentName:"li"},"mocking")," 工具。它们使您能够创建测试环境。但是, 有时您可以通过设计避免 ",Object(p.b)("inlineCode",{parentName:"li"},"mocking"),"。")),Object(p.b)("p",null,"在下一章中, 您将学习使用 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 部署应用程序。"))}i.isMDXComponent=!0,i=Object(c.hot)(e)(i),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(b.register(m,"makeShortcode","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/testing.md"),b.register(l,"MdAlert","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/testing.md"),b.register(N,"layoutProps","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/testing.md"),b.register("wrapper","MDXLayout","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/testing.md"),b.register(i,"MDXContent","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Techniques/testing.md")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)}.call(this,t(21)(e))}}]);