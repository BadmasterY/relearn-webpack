(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{161:function(e,a,n){"use strict";n.r(a),function(e){n.d(a,"default",(function(){return i}));var t,c=n(85),p=(n(127),n(0),n(86));function s(){return(s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function o(e,a){if(null==e)return{};var n,t,c=function(e,a){if(null==e)return{};var n,t,c={},p=Object.keys(e);for(t=0;t<p.length;t++)n=p[t],a.indexOf(n)>=0||(c[n]=e[n]);return c}(e,a);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(t=0;t<p.length;t++)n=p[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var b,r,m=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(p.b)("div",a)}},N=m("MdAlert"),l={};function i(e){var a=e.components,n=o(e,["components"]);return Object(p.b)("wrapper",s({},l,n,{components:a,mdxType:"MDXLayout"}),Object(p.b)("h2",{className:"__internal",id:"服务器端渲染"},"服务器端渲染",Object(p.b)("a",s({parentName:"h2"},{href:"#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"服务器端渲染"),"(Server Side Renderring, SSR)是一种技术, 允许使用 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML"),", ",Object(p.b)("inlineCode",{parentName:"p"},"JavaScript"),", ",Object(p.b)("inlineCode",{parentName:"p"},"CSS")," 甚至应用程序状态来提供初始有效负载。您将提供一个完全渲染的 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML")," 页面, 即使没有启用 ",Object(p.b)("inlineCode",{parentName:"p"},"JavaScript"),", 该页面也是有意义的。除了提供潜在的性能优势外, 这还可以帮助搜索引擎优化(Search Engine Optimization, SEO)。"),Object(p.b)("p",null,"尽管这个想法听起来并不是那么独特, 但还是有技术成本的。该方法由 ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 推广。此后, 出现了一些封装棘手方法的框架, 如 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/next",target:"_blank"}),"Next.js")," 和 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/razzle",target:"_blank"}),"razzle"),"。"),Object(p.b)("p",null,"为了演示 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR"),", 您可以使用 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 编译客户端构建, 然后由遵循该原理的 ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 渲染服务器获取它。这样做足以了解其工作原理以及问题从何而来。"),Object(p.b)("h3",{className:"__internal",id:"使用-react-设置-babel"},"使用 React 设置 Babel",Object(p.b)("a",s({parentName:"h3"},{href:"#%E4%BD%BF%E7%94%A8-react-%E8%AE%BE%E7%BD%AE-babel","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"../Developing/composing-configuration"}),'"组合配置"'),"一章介绍了配置方法, 而",Object(p.b)("a",s({parentName:"p"},{href:"../Loading/javascript"}),'"加载 JavaScript"'),"一章介绍了将 ",Object(p.b)("inlineCode",{parentName:"p"},"Babel")," 与 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 一起使用的要点。在继续后续内容之前, 应确保已完成基本设置。"),Object(p.b)("p",null,"要使用 ",Object(p.b)("inlineCode",{parentName:"p"},"React"),", 我们需要进一步的配置。鉴于大多数 ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 项目都依赖 ",Object(p.b)("inlineCode",{parentName:"p"},"JSX")," 格式, 因此您必须通过 ",Object(p.b)("inlineCode",{parentName:"p"},"Babel")," 启用它:"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," @babel/preset-react --develop"))),Object(p.b)("p",null,"将其与 ",Object(p.b)("inlineCode",{parentName:"p"},"Babel")," 配置连接如下:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},".babelrc")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(p.b)("pre",s({parentName:"div"},{className:"language-text"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-text"}),'{\n  ......\n  "presets": [\n    "@babel/preset-react",\n    ......\n  ]\n}'))),Object(p.b)("h3",{className:"__internal",id:"设置一个-react-演示"},"设置一个 React 演示",Object(p.b)("a",s({parentName:"h3"},{href:"#%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA-react-%E6%BC%94%E7%A4%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"为了确保项目具有相关性, 请安装 ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 和 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/react-dom",target:"_blank"}),"react-dom"),"。需要后一个程序包(",Object(p.b)("inlineCode",{parentName:"p"},"react-dom"),")才能将应用程序呈现到 ",Object(p.b)("inlineCode",{parentName:"p"},"DOM"),"。"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," react react-dom"))),Object(p.b)("p",null,"接下来, ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 代码需要一个小的入口文件。如果您在浏览器端, 则应该将带有 ",Object(p.b)("inlineCode",{parentName:"p"},"Hello world")," 的 ",Object(p.b)("inlineCode",{parentName:"p"},"div")," 挂载到文档中。为了证明它是可行的, 单击它应该显示一个带有 ",Object(p.b)("inlineCode",{parentName:"p"},'"hello"')," 消息的对话框。在服务器端, ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 组件被返回, 服务器可以获取它。"),Object(p.b)("p",null,"调整如下:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"src/ssr.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," React ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"react"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," ReactDOM ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"react-dom"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"SSR")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"<"),"div onClick",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"="),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"alert"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"hello"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),">"),"Hello world",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"<"),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"/"),"div",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),">"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token comment"}),"// Render only in the browser, export otherwise"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"if")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"typeof")," document ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"===")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"undefined"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  module",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"exports ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"SSR"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"else")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ReactDOM",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"hydrate"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"SSR"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," document",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"getElementById"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"app"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")))),Object(p.b)("p",null,"您仍然缺少 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 配置, 无法将此文件转换为服务器可以接收的文件。"),Object(p.b)(N,s({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"鉴于 ",Object(p.b)("inlineCode",{parentName:"p"},"ES2015")," 的导入和 ",Object(p.b)("inlineCode",{parentName:"p"},"CommonJS")," 的导出不能混合使用, 因此入口文件是用 ",Object(p.b)("inlineCode",{parentName:"p"},"CommonJS")," 样式编写的。")),Object(p.b)("h3",{className:"__internal",id:"配置-webpack"},"配置 webpack",Object(p.b)("a",s({parentName:"h3"},{href:"#%E9%85%8D%E7%BD%AE-webpack","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"为了保证原有配置的整洁, 我们将定义一个单独的配置文件。许多工作已经完成。鉴于您必须使用多个环境中的相同输出, 因此使用 ",Object(p.b)("inlineCode",{parentName:"p"},"UMD")," 作为库目标很有意义:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"webpack.ssr.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," path ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"path"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{")," merge ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"webpack-merge"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," parts ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"./webpack.parts"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\nmodule",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"exports ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"merge"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n    mode",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"production"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    entry",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n      index",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," path",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"join"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"src"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"ssr.js"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    output",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n      path",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," path",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"join"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"static"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n      filename",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"[name].js"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n      libraryTarget",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"umd"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n      globalObject",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"this"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n  parts",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"loadJavaScript"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"]"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";")))),Object(p.b)("p",null,"为了方便生成构建, 添加一个辅助脚本:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"package.json")),Object(p.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"json"},Object(p.b)("pre",s({parentName:"div"},{className:"language-json"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-json"}),Object(p.b)("span",s({parentName:"code"},{className:"token property"}),'"scripts"'),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  ",Object(p.b)("span",s({parentName:"span"},{className:"token property"}),'"build:ssr"'),Object(p.b)("span",s({parentName:"span"},{className:"token operator"}),":")," ",Object(p.b)("span",s({parentName:"span"},{className:"token string"}),'"wp --config webpack.ssr.js"'),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")),"  ......\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")))),Object(p.b)("p",null,"如果构建 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 演示(",Object(p.b)("inlineCode",{parentName:"p"},"npm run build:ssr"),"), 则应该看到一个新文件 ",Object(p.b)("inlineCode",{parentName:"p"},"./static/index.js"),"。下一步是设置服务器以呈现它。"),Object(p.b)("h3",{className:"__internal",id:"设置服务器"},"设置服务器",Object(p.b)("a",s({parentName:"h3"},{href:"#%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"为了让事件变得清晰明了, 可以设置一个独立的 ",Object(p.b)("inlineCode",{parentName:"p"},"Express")," 服务器, 可以获取生成的包并按照 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 规则进行渲染。先安装 ",Object(p.b)("inlineCode",{parentName:"p"},"Express"),":"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," express --develop"))),Object(p.b)("p",null,"如果需要运行生成的文件, 请按以下方式来实施服务器:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"server.js")),Object(p.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," express ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"express"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{")," renderToString ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"react-dom/server"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," ",Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"SSR")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"require"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"./static"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"server"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"process",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"env",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"PORT")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"||")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"8080"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"function")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"server"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),"port"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"const")," app ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"express"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  app",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"use"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"express",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"static"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"static"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n  app",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"get"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token string"}),'"/"'),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),"req",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")," res"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"=>"),"\n    res",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"status"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"200"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"send"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"renderMarkup"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"renderToString"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"SSR"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  app",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"listen"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"port",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"function")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"renderMarkup"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),"html"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"return")," ",Object(p.b)("span",s({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",s({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",s({parentName:"span"},{className:"token string"}),'<!DOCTYPE html>\n<html>\n  <head>\n    <title>Webpack SSR Demo</title>\n    <meta charset="utf-8" />\n  </head>\n  <body>\n    <div id="app">'),Object(p.b)("span",s({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",s({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"html",Object(p.b)("span",s({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(p.b)("span",s({parentName:"span"},{className:"token string"}),'</div>\n    <script src="./index.js"><\/script>\n  </body>\n</html>'),Object(p.b)("span",s({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")))),Object(p.b)("p",null,"立即运行服务器(",Object(p.b)("inlineCode",{parentName:"p"},"node ./server.js"),"), 然后在浏览器中输入 ",Object(p.b)("inlineCode",{parentName:"p"},"http://localhost:8080"),", 您应该会看到一些熟悉的东西:\n",Object(p.b)("img",s({parentName:"p"},{src:"../../output/hello.webp",alt:"Hello World"}))),Object(p.b)("p",null,"即使现在有一个 ",Object(p.b)("inlineCode",{parentName:"p"},"React")," 应用程序正在运行, 您也很难进行开发。如果您尝试修改代码, 则什么也不会发生。如",Object(p.b)("a",s({parentName:"p"},{href:"./multiple-pages"}),'"多页"'),"一章中所述, 可以通过在多编译器模式下运行 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 来解决该问题。另一种选择是针对当前配置以 ",Object(p.b)("inlineCode",{parentName:"p"},"watch")," 模式运行 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 并为服务器设置监视程序。接下来, 您将学习如何进行设置。"),Object(p.b)(N,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"如果想调试服务器的输出, 请设置 ",Object(p.b)("inlineCode",{parentName:"p"},"export DEBUG=express:application"),"。")),Object(p.b)(N,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"如果您按照",Object(p.b)("a",s({parentName:"p"},{href:"../Optimizing/separating-runtime"}),'"分离运行时"'),"一章中的描述编写清单, 则可以对 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 生成的资产的引用自动写入服务器端模板。")),Object(p.b)("h3",{className:"__internal",id:"监听-ssr-更改并刷新浏览器"},"监听 SSR 更改并刷新浏览器",Object(p.b)("a",s({parentName:"h3"},{href:"#%E7%9B%91%E5%90%AC-ssr-%E6%9B%B4%E6%94%B9%E5%B9%B6%E5%88%B7%E6%96%B0%E6%B5%8F%E8%A7%88%E5%99%A8","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"问题的第一部分很快得到解决。在终端中运行 ",Object(p.b)("inlineCode",{parentName:"p"},"npm run build:ssr -- --watch"),"。这迫使 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 在 ",Object(p.b)("inlineCode",{parentName:"p"},"watch")," 模式下运行。为了方便起见, 可以将此思想包装在 ",Object(p.b)("inlineCode",{parentName:"p"},"npm")," 脚本中, 但这对于本演示来说已经足够。"),Object(p.b)("p",null,"剩下的部分比到目前为止要困难的多。如何使服务器知道更改以及如何将更改传达给浏览器？"),Object(p.b)("p",null,Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/browser-refresh",target:"_blank"}),"browser-refresh")," 可以派上用场, 因为它可以解决这两个问题。首先安装:"),Object(p.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(p.b)("pre",s({parentName:"div"},{className:"language-bash"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-bash"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"npm")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"add")," browser-refresh --develop"))),Object(p.b)("p",null,"客户端部分需要对服务器代码进行两个小的更改:"),Object(p.b)("p",null,Object(p.b)("strong",{parentName:"p"},"server.js")),Object(p.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"js"},Object(p.b)("pre",s({parentName:"div"},{className:"language-js"}),Object(p.b)("code",s({parentName:"pre"},{className:"language-js"}),Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"server"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),"process",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),"env",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"code"},{className:"token constant"}),"PORT")," ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"||")," ",Object(p.b)("span",s({parentName:"code"},{className:"token number"}),"8080"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"function")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"server"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),"port"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),Object(p.b)("span",s({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  ",Object(p.b)("span",s({parentName:"span"},{className:"token comment"}),"// app.listen(port);")),"\n",Object(p.b)("span",s({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  app",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"span"},{className:"token function"}),"listen"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"("),"port",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),",")," ",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"span"},{className:"token operator"}),"=>")," process",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),"send ",Object(p.b)("span",s({parentName:"span"},{className:"token operator"}),"&&")," process",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"span"},{className:"token function"}),"send"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"span"},{className:"token string"}),'"online"'),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),")"),Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),";")),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"function")," ",Object(p.b)("span",s({parentName:"code"},{className:"token function"}),"renderMarkup"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"("),Object(p.b)("span",s({parentName:"code"},{className:"token parameter"}),"html"),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),")")," ",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(p.b)("span",s({parentName:"code"},{className:"token keyword"}),"return")," ",Object(p.b)("span",s({parentName:"code"},{className:"token template-string"}),Object(p.b)("span",s({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(p.b)("span",s({parentName:"span"},{className:"token string"}),"<!DOCTYPE html>\n<html>\n  ......\n  <body>\n    ......\n",Object(p.b)("span",s({parentName:"span"},{className:"rcpress-highlight-code-line"}),'    <script src="'),Object(p.b)("span",s({parentName:"span"},{className:"token interpolation"}),Object(p.b)("span",s({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"process",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),"env",Object(p.b)("span",s({parentName:"span"},{className:"token punctuation"}),"."),Object(p.b)("span",s({parentName:"span"},{className:"token constant"}),"BROWSER_REFRESH_URL"),Object(p.b)("span",s({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(p.b)("span",s({parentName:"span"},{className:"token string"}),'"><\/script>'),"  </body>\n</html>"),Object(p.b)("span",s({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(p.b)("span",s({parentName:"code"},{className:"token punctuation"}),"}")))),Object(p.b)("p",null,"第一个更改告诉客户端该应用程序已联机并且可以使用。后一个更改将客户端脚本附加到输出。",Object(p.b)("inlineCode",{parentName:"p"},"browser-refresh")," 管理相关的环境变量。"),Object(p.b)("p",null,"在一个终端中运行 ",Object(p.b)("inlineCode",{parentName:"p"},"node_modules/.bin/browser-refresh ./server.js"),", 然后通过 ",Object(p.b)("inlineCode",{parentName:"p"},"http://localhost:8080")," 像以前一样打开浏览器以测试设置。同时在另一个终端上以 ",Object(p.b)("inlineCode",{parentName:"p"},"watch")," 模式运行 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack"),"(",Object(p.b)("inlineCode",{parentName:"p"},"npm run build:ssr"),")。如果一切顺利, 对演示客户端脚本(",Object(p.b)("inlineCode",{parentName:"p"},"./src/ssr.js"),")所做的任何修改都将在浏览器中显示, 或者在服务器上导致失败。"),Object(p.b)("p",null,"如果服务器崩溃, 则会丢失 ",Object(p.b)("inlineCode",{parentName:"p"},"WebSocket")," 连接。在这种情况下, 必须在浏览器中强制刷新。如果服务器也是通过 ",Object(p.b)("inlineCode",{parentName:"p"},"webpack")," 进行管理的, 则可以规避这个问题。"),Object(p.b)("p",null,"为了证明 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 是有效的, 请打开浏览器控制台。您应该可以看到一些熟悉的东西:\n",Object(p.b)("img",s({parentName:"p"},{src:"../../output/ssr.png",alt:"SSR 输出"}))),Object(p.b)("p",null,"您可以在那里看到所有相关的 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML"),", 而不仅仅是安装应用程序的 ",Object(p.b)("inlineCode",{parentName:"p"},"div"),"。在这种特殊情况下, 这里内容并不多, 但足以展示这种方法。"),Object(p.b)(N,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"可以通过为服务器实现生产模式来进一步完善, 该生产模式将至少应跳过注入 ",Object(p.b)("inlineCode",{parentName:"p"},"browser-refresh")," 脚本的过程。服务器可以将初始数据有效载荷注入到生成的 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML")," 中。这样做可以避免在客户端进行查询。")),Object(p.b)("h3",{className:"__internal",id:"开放式问题"},"开放式问题",Object(p.b)("a",s({parentName:"h3"},{href:"#%E5%BC%80%E6%94%BE%E5%BC%8F%E9%97%AE%E9%A2%98","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,"尽管该演示说明了 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 的基本概念, 但仍然存在未解决的问题:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"如何处理样式? ",Object(p.b)("inlineCode",{parentName:"li"},"Node")," 不了解与 ",Object(p.b)("inlineCode",{parentName:"li"},"CSS")," 相关的导入。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"除了 ",Object(p.b)("inlineCode",{parentName:"li"},"JavaScript")," 以外, 该如何处理? 如果服务器端是通过 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 处理的, 那么这将不是什么大问题, 因为您可以在 ",Object(p.b)("inlineCode",{parentName:"li"},"webpack")," 上对其进行处理。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"如何通过 ",Object(p.b)("inlineCode",{parentName:"li"},"Node")," 以外的其他服务器运行服务器? 一种选择是将 ",Object(p.b)("inlineCode",{parentName:"li"},"Node")," 实例包装在服务中, 然后通过主机环境运行该服务。理想情况下, 结果将被缓存, 并且您可以针对每个平台(例如 ",Object(p.b)("inlineCode",{parentName:"li"},"Java")," 和其他平台)找到针对此特定条件的更具体的解决方案。")),Object(p.b)("p",null,"诸如此类的问题是诸如 ",Object(p.b)("inlineCode",{parentName:"p"},"Next.js")," 或 ",Object(p.b)("inlineCode",{parentName:"p"},"razzle")," 之类的解决方案之所以存在的原因。它们旨在解决此类 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 特定问题。"),Object(p.b)(N,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},"路由本身是一个很大的问题, 可以通过 ",Object(p.b)("inlineCode",{parentName:"p"},"Next.js")," 之类的框架解决。",Object(p.b)("a",s({parentName:"p"},{href:"https://ebaytech.berlin/universal-web-apps-with-react-router-4-15002bb30ccb",target:"_blank"}),"Patrick Hund 讨论了如何使用 React 和 React Router 4 来解决这个问题"),"。")),Object(p.b)(N,s({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(p.b)("p",{parentName:"MdAlert"},Object(p.b)("inlineCode",{parentName:"p"},"Webpack")," 提供了 ",Object(p.b)("a",s({parentName:"p"},{href:"https://webpack.js.org/api/module-methods/#requireresolveweak",target:"_blank"}),"require.resolveWeak")," 来实现 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR"),"。这是解决方案使用的特定功能, 例如下面的 ",Object(p.b)("a",s({parentName:"p"},{href:"https://www.npmjs.com/package/react-universal-component",target:"_blank"}),"react-universal-component"),"。")),Object(p.b)("h3",{className:"__internal",id:"预渲染"},"预渲染",Object(p.b)("a",s({parentName:"h3"},{href:"#%E9%A2%84%E6%B8%B2%E6%9F%93","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 不是解决 ",Object(p.b)("inlineCode",{parentName:"p"},"SEO")," 问题的唯一解决方案。",Object(p.b)("strong",{parentName:"p"},"预渲染"),"是一种更容易实现的替代技术。关键是使用无头浏览器呈现页面的初始 ",Object(p.b)("inlineCode",{parentName:"p"},"HTML")," 标记, 然后将其提供给搜索引擎。需要注意的是, 该方法不适用于高度动态的数据。",Object(p.b)("inlineCode",{parentName:"p"},"Webpack")," 存在以下解决方案:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/prerender-spa-plugin",target:"_blank"}),"prerender-spa-plugin")," 在内部使用 ",Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/puppeteer",target:"_blank"}),"Puppeteer"),"。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("a",s({parentName:"li"},{href:"https://www.npmjs.com/package/prerender-loader",target:"_blank"}),"prerender-loader")," 与 ",Object(p.b)("inlineCode",{parentName:"li"},"html-webpack-plugin")," 集成在一起, 但在没有 ",Object(p.b)("inlineCode",{parentName:"li"},"HTML")," 文件的情况下也可以工作。加载器非常灵活, 可以进行定制以适合您的用例(即 ",Object(p.b)("inlineCode",{parentName:"li"},"React")," 或其他框架)。")),Object(p.b)("h3",{className:"__internal",id:"结论"},"结论",Object(p.b)("a",s({parentName:"h3"},{href:"#%E7%BB%93%E8%AE%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(p.b)("p",null,Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 带来了技术挑战, 为此, 围绕着它出现了具体的解决方案。",Object(p.b)("inlineCode",{parentName:"p"},"Webpack")," 非常适合 ",Object(p.b)("inlineCode",{parentName:"p"},"SSR")," 设置。"),Object(p.b)("p",null,"回顾一下:"),Object(p.b)("ul",null,Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),"服务器端渲染(",Object(p.b)("inlineCode",{parentName:"li"},"SSR"),")可以为浏览器提供更多的初始渲染。无需等待 ",Object(p.b)("inlineCode",{parentName:"li"},"JavaScript")," 加载, 您可以立即显示标记。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("inlineCode",{parentName:"li"},"SSR")," 还允许您将数据的初始有效负载传递给客户端, 以避免对服务器进行不必要的查询。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("inlineCode",{parentName:"li"},"Webpack")," 可以管理与客户端部分相关的问题。如果需要更集成的解决方案, 它也可以用于生成服务器。",Object(p.b)("inlineCode",{parentName:"li"},"Next.js")," 之类的抽象隐藏了这些细节。"),Object(p.b)("li",s({parentName:"ul"},{className:"__internal"}),Object(p.b)("inlineCode",{parentName:"li"},"SSR")," 并非没有代价, 并且会导致新的问题, 因为您需要更好的方法来处理诸如样式或路由之类的问题。服务器和客户端环境在本质上有所不同, 因此必须编写代码, 以使它不会过多依赖于平台特定的功能。")),Object(p.b)("p",null,"在下一章中, 我们将学习微前端和 ",Object(p.b)("inlineCode",{parentName:"p"},"Module Federation"),"。"))}i.isMDXComponent=!0,i=Object(c.hot)(e)(i),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(b.register(m,"makeShortcode","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Output/server-side-rendering.md"),b.register(N,"MdAlert","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Output/server-side-rendering.md"),b.register(l,"layoutProps","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Output/server-side-rendering.md"),b.register("wrapper","MDXLayout","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Output/server-side-rendering.md"),b.register(i,"MDXContent","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Output/server-side-rendering.md")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)}.call(this,n(21)(e))}}]);