(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{139:function(e,a,n){"use strict";n.r(a),function(e){n.d(a,"default",(function(){return i}));var t,c=n(86),s=(n(127),n(0),n(87));function o(){return(o=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function p(e,a){if(null==e)return{};var n,t,c=function(e,a){if(null==e)return{};var n,t,c={},s=Object.keys(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||(c[n]=e[n]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)n=s[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var b,m,r=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(s.b)("div",a)}},N=r("MdAlert"),l={};function i(e){var a=e.components,n=p(e,["components"]);return Object(s.b)("wrapper",o({},l,n,{components:a,mdxType:"MDXLayout"}),Object(s.b)("h2",{className:"__internal",id:"组合配置"},"组合配置",Object(s.b)("a",o({parentName:"h2"},{href:"#%E7%BB%84%E5%90%88%E9%85%8D%E7%BD%AE","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"尽管到目前为止, ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 所做的工作还不是很多, 但配置的数量却以肉眼可见的速度增长。现在您必须小心其组成方式, 因为在项目中有单独的生产和开发目标。当您想添加更多功能进行测试和其他用途时, 情况只会变得更糟。"),Object(s.b)("p",null,"使用单个整体配置文件会影响可读性, 并降低复用性。随着项目需求的增多, 您必须找出更有效地管理 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 配置的方法。"),Object(s.b)("h3",{className:"__internal",id:"可行的管理配置方式"},"可行的管理配置方式",Object(s.b)("a",o({parentName:"h3"},{href:"#%E5%8F%AF%E8%A1%8C%E7%9A%84%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"您可以通过以下方式管理 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 配置:"),Object(s.b)("ul",null,Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"在不同环境的多个文件中维护配置, 并通过 ",Object(s.b)("mark",null,"--config")," 参数将 ",Object(s.b)("inlineCode",{parentName:"li"},"webpack")," 指向每个文件, 通过导入模块共享配置。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"使用相关的库来维护配置。示例: ",Object(s.b)("a",o({parentName:"li"},{href:"https://github.com/namics/webpack-config-plugins",target:"_blank"}),"webpack-config-plugins"),", ",Object(s.b)("a",o({parentName:"li"},{href:"https://neutrino.js.org/",target:"_blank"}),"Neutrino"),", ",Object(s.b)("a",o({parentName:"li"},{href:"https://www.npmjs.com/package/webpack-blocks",target:"_blank"}),"webpack-blocks"),"。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"交由工具来维护配置。示例: ",Object(s.b)("a",o({parentName:"li"},{href:"https://www.npmjs.com/package/create-react-app",target:"_blank"}),"create-react-app"),", ",Object(s.b)("a",o({parentName:"li"},{href:"https://www.npmjs.com/package/kyt",target:"_blank"}),"kyt"),", ",Object(s.b)("a",o({parentName:"li"},{href:"https://www.npmjs.com/package/nwb",target:"_blank"}),"nwb"),"。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"在单个文件中维护所有配置, 然后在其中分支并依靠 ",Object(s.b)("mark",null,"--mode")," 参数。该方法将在本章稍后详细说明。")),Object(s.b)("p",null,"我的首选方法是使用一组小函数组合成 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 配置。本书的开发是基于这种形式展开的, 因为它为您提供了可以逐步解决问题的能力, 同时为您提供了基于 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 配置和相关技术的小型 ",Object(s.b)("inlineCode",{parentName:"p"},"API"),"。"),Object(s.b)("h3",{className:"__internal",id:"通过合并组合配置"},"通过合并组合配置",Object(s.b)("a",o({parentName:"h3"},{href:"#%E9%80%9A%E8%BF%87%E5%90%88%E5%B9%B6%E7%BB%84%E5%90%88%E9%85%8D%E7%BD%AE","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"在基于组合的方法中, 您将 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 配置拆分, 然后将其合并在一起。问题是, 使用 ",Object(s.b)("mark",null,"Object.assign")," 等特性合并对象的常规方法不能正确处理数组, 因为如果两个对象都有相同命名的数组, 就会丢失数据。处于这个原因, 我开发了 ",Object(s.b)("a",o({parentName:"p"},{href:"https://www.npmjs.org/package/webpack-merge",target:"_blank"}),"webpack-merge"),"。"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"webpack-merge")," 其核心做了两件事: 拼接数组和合并对象, 而不是简单的覆盖它们。下面的示例详细显示了该行为:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",o({parentName:"div"},{className:"language-js"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-js"}),Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," merge ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"webpack-merge"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"merge"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," a",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"1"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," b",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"5"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," c",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"20")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," a",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"2"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," b",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"10"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," d",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"421")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),"// => { a: [ 1, 2 ], b: 10, c: 20, d: 421 }")))),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"webpack-merge")," 通过策略提供了更多控制, 使您可以按字段控制其行为。它们使您可以强制它附加, 添加或替换内容。"),Object(s.b)("p",null,"尽管 ",Object(s.b)("strong",{parentName:"p"},"webpack-merge")," 是为本书设计的, 但事实证明, 它不仅是本书的学习工具。如果您觉得它好用的话, 可以尝试把它带到您的工作中去。"),Object(s.b)(N,o({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(s.b)("p",{parentName:"MdAlert"},Object(s.b)("a",o({parentName:"p"},{href:"https://www.npmjs.com/package/webpack-chain",target:"_blank"}),"webpack-chain")," 提供了用于配置 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 的链式 ",Object(s.b)("inlineCode",{parentName:"p"},"API"),", 使您能够在启用合成时避免与配置相关的问题。")),Object(s.b)("h3",{className:"__internal",id:"设置-webpack-merge"},"设置 ",Object(s.b)("inlineCode",{parentName:"h3"},"webpack-merge"),Object(s.b)("a",o({parentName:"h3"},{href:"#%E8%AE%BE%E7%BD%AE-webpack-merge","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"首先, 将 ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("inlineCode",{parentName:"strong"},"webpack-merge"))," 添加到项目中:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(s.b)("pre",o({parentName:"div"},{className:"language-bash"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-bash"}),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"npm")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"add")," webpack-merge --develop"))),Object(s.b)("p",null,"为了提供一定程度的抽象, 您可以为更高级别的配置定义 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.config.js"),", 为要使用的配置部分定义 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.parts.js"),"。这是开发服务器的功能:"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"webpack.parts.js")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",o({parentName:"div"},{className:"language-js"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-js"}),Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," WebpackPluginServe ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"webpack-plugin-serve"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  MiniHtmlWebpackPlugin",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"mini-html-webpack-plugin"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\nexports",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function-variable function"}),"devServer")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  watch",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token boolean"}),"true"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n  plugins",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"new")," ",Object(s.b)("span",o({parentName:"code"},{className:"token class-name"}),"WebpackPluginServe"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n      port",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," process",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"env",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token constant"}),"PORT")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"||")," ",Object(s.b)("span",o({parentName:"code"},{className:"token number"}),"8080"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"static"),Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"./dist"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),"// Expose if output.path changes"),"\n      liveReload",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token boolean"}),"true"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n      waitForBuild",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token boolean"}),"true"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\nexports",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function-variable function"}),"page")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token parameter"}),Object(s.b)("span",o({parentName:"span"},{className:"token punctuation"}),"{")," title ",Object(s.b)("span",o({parentName:"span"},{className:"token punctuation"}),"}")),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  plugins",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"new")," ",Object(s.b)("span",o({parentName:"code"},{className:"token class-name"}),"MiniHtmlWebpackPlugin"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n      context",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n        title",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";")))),Object(s.b)(N,o({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(s.b)("p",{parentName:"MdAlert"},"为了简单起见, 我们将使用 ",Object(s.b)("inlineCode",{parentName:"p"},"JavaScript")," 开发所有配置。在这里也可以使用 ",Object(s.b)("inlineCode",{parentName:"p"},"TypeScript"),"。如果您想这样做, 请参阅",Object(s.b)("a",o({parentName:"p"},{href:""}),"加载JavaScript"),"一章了解所需的 ",Object(s.b)("inlineCode",{parentName:"p"},"TypeScript")," 配置。")),Object(s.b)("p",null,"要连接此配置, 请按照以下代码示例进行 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.config.js")," 配置:"),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"webpack.config.js")),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",o({parentName:"div"},{className:"language-js"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-js"}),Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," mode ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"webpack-nano/argv"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," merge ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"webpack-merge"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," parts ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"./webpack.parts"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," commonConfig ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"merge"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    entry",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"./src"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"webpack-plugin-serve/client"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n  parts",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"page"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," title",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":")," ",Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"Webpack demo"')," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," productionConfig ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"merge"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," developmentConfig ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"merge"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),"parts",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"devServer"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function-variable function"}),"getConfig")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token parameter"}),"mode"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"switch")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"mode",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"case")," ",Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"production"'),Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":"),"\n      ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"return")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"merge"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"commonConfig",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," productionConfig",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," mode ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"case")," ",Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"development"'),Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":"),"\n      ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"return")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"merge"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"commonConfig",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," developmentConfig",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{")," mode ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"default"),Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),":"),"\n      ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"throw")," ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"new")," ",Object(s.b)("span",o({parentName:"code"},{className:"token class-name"}),"Error"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token template-string"}),Object(s.b)("span",o({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(s.b)("span",o({parentName:"span"},{className:"token string"}),"Trying to use an unknown mode, "),Object(s.b)("span",o({parentName:"span"},{className:"token interpolation"}),Object(s.b)("span",o({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"mode",Object(s.b)("span",o({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(s.b)("span",o({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\nmodule",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"exports ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"getConfig"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"mode",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";")))),Object(s.b)("p",null,"在这些更改之后, 构建的行为应该与以前相同。不过现在您有了扩展的空间, 并且您不必担心如何组合配置的不同部分。"),Object(s.b)("p",null,"您可以通过扩展 ",Object(s.b)("inlineCode",{parentName:"p"},"package.json")," 定义并根据需要在 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.config.js")," 上分支来添加更多目标。",Object(s.b)("inlineCode",{parentName:"p"},"webpack.parts.js")," 为包含特定的技术, 然后您可以使用这些技术来组合配置。"),Object(s.b)(N,o({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(s.b)("p",{parentName:"MdAlert"},"目前 ",Object(s.b)("mark",null,"productionConfig")," 是一个保留项, 随着我们进一步扩展配置, 它会被逐渐完善。")),Object(s.b)(N,o({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(s.b)("p",{parentName:"MdAlert"},"代码中使用的 ",Object(s.b)("a",o({parentName:"p"},{href:"https://nodejs.org/api/process.html",target:"_blank"}),"process")," 模块是由 ",Object(s.b)("inlineCode",{parentName:"p"},"Node")," 提供的全局变量。除 ",Object(s.b)("inlineCode",{parentName:"p"},"env")," 之外, 它还提供了许多其他功能, 可让您获取主机系统的更多信息。")),Object(s.b)(N,o({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(s.b)("p",{parentName:"MdAlert"},"默认情况下, ",Object(s.b)("a",o({parentName:"p"},{href:"https://github.com/webpack/webpack/issues/7074",target:"_blank"}),"webpack 不基于 mode 设置全局 NODE_ENV"),"。如果您有任何外部工具依赖它(如 ",Object(s.b)("inlineCode",{parentName:"p"},"Babel"),"), 请确保显式地设置它。为此, 在 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 配置函数中设置 ",Object(s.b)("inlineCode",{parentName:"p"},"process.env.NODE_ENV = mode;"))),Object(s.b)("h3",{className:"__internal",id:"组合配置的好处"},"组合配置的好处",Object(s.b)("a",o({parentName:"h3"},{href:"#%E7%BB%84%E5%90%88%E9%85%8D%E7%BD%AE%E7%9A%84%E5%A5%BD%E5%A4%84","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"组合配置有几个好处:"),Object(s.b)("ul",null,Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"将配置拆分成较小的功能可以让您继续扩展配置。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"如果您正在使用诸如 ",Object(s.b)("inlineCode",{parentName:"li"},"TypeScript")," 的语言, 则可以使用 ",Object(s.b)("inlineCode",{parentName:"li"},"type function"),"。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"如果您在多个项目使用配置, 则可以将配置作为包发布, 然后只需要修改基础配置的一个位置便可以优化和升级。",Object(s.b)("a",o({parentName:"li"},{href:"https://survivejs.com/maintenance/",target:"_blank"}),"SurviveJS - Maintenance")," 涵盖了与该方法有关的实践。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"将配置视为一个包, 可以将其进行版本控制, 并提供更改日志以将更改记录在案。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"如果实现的足够完善, 您最终可以拥有自己的 ",Object(s.b)("strong",{parentName:"li"},"create-react-app"),", 它可以用您喜欢的首选配置快速生成项目。")),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"译者注: ",Object(s.b)("strong",{parentName:"p"},"SurviveJS - Maintenance")," 为另一个内容(英文文档), 不做过多介绍, 感兴趣可以自行查阅。")),Object(s.b)("h3",{className:"__internal",id:"配置布局"},"配置布局",Object(s.b)("a",o({parentName:"h3"},{href:"#%E9%85%8D%E7%BD%AE%E5%B8%83%E5%B1%80","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"在本书项目中, 您将所有配置推送到两个文件中: ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.config.js")," 和 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.parts.js"),"。前者包含较高级别的配置, 而较低级别则将与 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 细节隔离。可选择的方法允许比我们现有的方法具备更灵活的文件布局。"),Object(s.b)("h4",{className:"__internal",id:"按配置目标拆分"},"按配置目标拆分",Object(s.b)("a",o({parentName:"h4"},{href:"#%E6%8C%89%E9%85%8D%E7%BD%AE%E7%9B%AE%E6%A0%87%E6%8B%86%E5%88%86","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"如果按目标分割配置, 则可能会得到如下文件结构:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(s.b)("pre",o({parentName:"div"},{className:"language-text"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-text"}),".\n└── config\n    ├── webpack.common.js\n    ├── webpack.development.js\n    ├── webpack.parts.js\n    └── webpack.production.js"))),Object(s.b)("p",null,"在这种情况下, 您将通过 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack")," 的 ",Object(s.b)("inlineCode",{parentName:"p"},"--config")," 参数指向目标, 并通过 ",Object(s.b)("inlineCode",{parentName:"p"},"merge")," 进行通用配置: ",Object(s.b)("inlineCode",{parentName:"p"},"module.exports = merge(common, config)"),";"),Object(s.b)("h4",{className:"__internal",id:"按用途拆分"},"按用途拆分",Object(s.b)("a",o({parentName:"h4"},{href:"#%E6%8C%89%E7%94%A8%E9%80%94%E6%8B%86%E5%88%86","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"要将层次结构添加到管理配置部件的方式中, 可以拆分 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.parts.js")," 的每个类别:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(s.b)("pre",o({parentName:"div"},{className:"language-text"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-text"}),".\n└── config\n    ├── parts\n    │   ├── devserver.js\n    ...\n    │   ├── index.js\n    │   └── javascript.js\n    └── ..."))),Object(s.b)("p",null,"这种安排可以更快地找到与类别相关的配置。此外, 如果您要使用已发布包中的配置, 它还可以减少构建时间, 因为这样只需要加载所需的插件。为了提高可读性, 一个不错的选择是在单个文件中放置所有方法, 并使用注释将其拆分。"),Object(s.b)("h3",{className:"__internal",id:"构建自己的配置包指南"},"构建自己的配置包指南",Object(s.b)("a",o({parentName:"h3"},{href:"#%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8C%85%E6%8C%87%E5%8D%97","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"如果您使用我提到的配置包方法, 请考虑以下准则:"),Object(s.b)("ul",null,Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"使用 ",Object(s.b)("inlineCode",{parentName:"li"},"TypeScript")," 开发软件包定义接口是有意义的。如要在 ",Object(s.b)("inlineCode",{parentName:"li"},"TypeScript")," 中编写配置, ",Object(s.b)("a",o({parentName:"li"},{href:""}),'"加载JavaScript"'),"一章中讨论的那样将十分有用。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"一次仅公开包含一项功能的函数。例如, 这样做可以轻松替换",Object(s.b)("a",o({parentName:"li"},{href:"../Appendices/hmr.html"}),"模块热更新"),"的实现方式。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"通过函数参数提供足够的定制选项。最好公开一个对象, 这样可以模拟 ",Object(s.b)("inlineCode",{parentName:"li"},"JavaScript")," 中的命名参数。然后, 您可以从中解构参数, 同时将其与默认值和 ",Object(s.b)("inlineCode",{parentName:"li"},"TypeScript")," 类型优雅结合。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"在配置包中包含所有相关的依赖项。在特定情况下, 如果希望使用者能够控制特定版本, 可以使用 ",Object(s.b)("inlineCode",{parentName:"li"},"peerDependencies"),"。这样做意味着您可能会下载更多所需的依赖项, 但这是一个很好的折衷方案。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"对于包含加载器字符串的参数, 请使用 ",Object(s.b)("inlineCode",{parentName:"li"},"require.resolve")," 针对配置包中的加载器进行解析。否则, 在寻找加载器的错误位置时, 构建可能会失败。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"包装装载器时, 请在函数参数中使用相关的 ",Object(s.b)("inlineCode",{parentName:"li"},"TypeScript")," 类型。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"考虑使用快照声明输出更改来测试软件包(在 ",Object(s.b)("inlineCode",{parentName:"li"},"Jest")," 中使用 ",Object(s.b)("inlineCode",{parentName:"li"},"expect().toMatchSnapshot()"),")。")),Object(s.b)("p",null,"诀窍是将 ",Object(s.b)("a",o({parentName:"p"},{href:"https://www.npmjs.com/package/memory-fs",target:"_blank"}),"memory-fs")," 与 ",Object(s.b)("inlineCode",{parentName:"p"},"compiler.outputFileSystem")," 通过以下各项结合使用:"),Object(s.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(s.b)("pre",o({parentName:"div"},{className:"language-js"}),Object(s.b)("code",o({parentName:"pre"},{className:"language-js"}),Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," webpack ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"webpack"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," MemoryFs ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"memory-fs"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," _ ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"lodash"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," config ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"require"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"./webpack.config"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," compiler ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"webpack"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"config",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\ncompiler",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"outputFileSystem ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"new")," ",Object(s.b)("span",o({parentName:"code"},{className:"token class-name"}),"MemoryFs"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\ncompiler",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"run"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token parameter"}),"err",Object(s.b)("span",o({parentName:"span"},{className:"token punctuation"}),",")," stats"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=>")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),"// 1. Handle possible err and stats.hasErrors() case"),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"if")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"err ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"||")," stats",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"hasErrors"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")")," ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),'// stats.toString("errors-only") contains the errors'),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"return")," ",Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"reject"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"err",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," pathParts ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," compiler",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"outputFileSystem ",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),"// Check webpack fs"),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"pathToArray"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),"\n    ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"concat"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"["),Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"dist"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),",")," ",Object(s.b)("span",o({parentName:"code"},{className:"token string"}),'"main.js"'),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"]"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),"// https://lodash.com/docs/4.17.15#get"),"\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token keyword"}),"const")," file ",Object(s.b)("span",o({parentName:"code"},{className:"token operator"}),"=")," _",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"get"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),"\n    compiler",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"outputFileSystem",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),"data",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),","),"\n    pathParts\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"."),Object(s.b)("span",o({parentName:"code"},{className:"token function"}),"toString"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"("),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(s.b)("span",o({parentName:"code"},{className:"token comment"}),"// 3. TODO: Assert the file using your testing framework."),"\n",Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),"}"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),")"),Object(s.b)("span",o({parentName:"code"},{className:"token punctuation"}),";")))),Object(s.b)(N,o({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(s.b)("p",{parentName:"MdAlert"},"相关讨论, 请参见 ",Object(s.b)("a",o({parentName:"p"},{href:"https://stackoverflow.com/questions/39923743/is-there-a-way-to-get-the-output-of-webpack-node-api-as-a-string",target:"_blank"}),"Stack Overflow"),"。")),Object(s.b)("h3",{className:"__internal",id:"结论"},"结论",Object(s.b)("a",o({parentName:"h3"},{href:"#%E7%BB%93%E8%AE%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(s.b)("p",null,"即使配置在技术上与以前相同, 现在您仍然可以通过 ",Object(s.b)("inlineCode",{parentName:"p"},"merge")," 来扩展它。"),Object(s.b)("p",null,"回顾一下:"),Object(s.b)("ul",null,Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"鉴于 ",Object(s.b)("inlineCode",{parentName:"li"},"webpack")," 的配置位于 ",Object(s.b)("inlineCode",{parentName:"li"},"JavaScript")," 代码中, 有很多方法可以对其进行管理。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"您应该选择一种对您最有意义的配置方法。开发 ",Object(s.b)("a",o({parentName:"li"},{href:"https://www.npmjs.com/package/webpack-merge",target:"_blank"}),"webpack-merge")," 是为了提供一种简便的组合方法, 但是您可以找到许多其他的选择。"),Object(s.b)("li",o({parentName:"ul"},{className:"__internal"}),"组合可以实现配置共享。您不必维护每个存储库的自定义配置, 而是可以通过组合的方式在存储库之间共享它。使用 ",Object(s.b)("inlineCode",{parentName:"li"},"npm")," 软件包可以做到这一点。开发配置接近于开发任何其他代码。但是这一次, 您将您的实践整理为软件包。")),Object(s.b)("p",null,"本书的下一部分将介绍不同的技术, 并会大量修改 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.parts.js"),"。但幸运的是, 对 ",Object(s.b)("inlineCode",{parentName:"p"},"webpack.config.js")," 的更改是微乎其微的。"))}i.isMDXComponent=!0,i=Object(c.hot)(e)(i),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(b.register(r,"makeShortcode","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Developing/composing-configuration.md"),b.register(N,"MdAlert","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Developing/composing-configuration.md"),b.register(l,"layoutProps","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Developing/composing-configuration.md"),b.register("wrapper","MDXLayout","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Developing/composing-configuration.md"),b.register(i,"MDXContent","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Developing/composing-configuration.md")),(m="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&m(e)}.call(this,n(21)(e))}}]);