(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{150:function(e,a,t){"use strict";t.r(a),function(e){t.d(a,"default",(function(){return N}));var n,p=t(85),c=(t(127),t(0),t(86));function b(){return(b=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function s(e,a){if(null==e)return{};var t,n,p=function(e,a){if(null==e)return{};var t,n,p={},c=Object.keys(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||(p[t]=e[t]);return p}(e,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(p[t]=e[t])}return p}(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var o,r,m=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(c.b)("div",a)}},l=m("MdAlert"),i={};function N(e){var a=e.components,t=s(e,["components"]);return Object(c.b)("wrapper",b({},i,t,{components:a,mdxType:"MDXLayout"}),Object(c.b)("h2",{className:"__internal",id:"加载-javascript"},"加载 JavaScript",Object(c.b)("a",b({parentName:"h2"},{href:"#%E5%8A%A0%E8%BD%BD-javascript","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"Webpack")," 默认处理 ",Object(c.b)("inlineCode",{parentName:"p"},"ES2015")," 模块定义并将其转换为代码。但是它",Object(c.b)("strong",{parentName:"p"},"不会"),"转换特定的语法, 比如 ",Object(c.b)("inlineCode",{parentName:"p"},"const"),"。生成的代码可能会有问题, 尤其是在老版本浏览器中。"),Object(c.b)("p",null,"为了更好地了解默认转换, 请考虑下面的示例输出(",Object(c.b)("inlineCode",{parentName:"p"},"npm run build--mode none"),"):"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"dist/main.js")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"/***/")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"function"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token parameter"}),"module",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")," __webpack_exports__",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")," __webpack_require__"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"use strict"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n__webpack_require__",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"r"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"__webpack_exports__",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"/* harmony default export */")," __webpack_exports__",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"default"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"text ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"Hello world"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=>")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"const")," element ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," document",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"createElement"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"div"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  element",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"className ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"rounded bg-red-100 border max-w-md m-4 p-4"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n  element",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"innerHTML ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," text",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"return")," element",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"...")))),Object(c.b)("p",null,"这个问题可以通过 ",Object(c.b)("a",b({parentName:"p"},{href:"https://babeljs.io/",target:"_blank"}),"Babel")," 来解决, ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 是一个著名的 ",Object(c.b)("inlineCode",{parentName:"p"},"JavaScript")," 编译器, 支持 ",Object(c.b)("inlineCode",{parentName:"p"},"ES2015+")," 等功能。它类似于 ",Object(c.b)("inlineCode",{parentName:"p"},"ESLint"),", 因为它构建在预设和插件之上。预设是插件的集合, 您也可以定义自己的插件。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 不是唯一的选择, 尽管它是最受欢迎的选择。如果您不需要任何特定的 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 预设或插件, 则可以选择 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/esbuild-loader",target:"_blank"}),"esbuild-loader"),", ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/swc-loader",target:"_blank"}),"swc-loader")," 和 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/@sucrase/webpack-loader",target:"_blank"}),"@sucrase/webpack-loader"),"。")),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"鉴于有时扩展现有预设是不够的, ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/modify-babel-preset",target:"_blank"}),"modify-babel-preset")," 允许您更进一步, 以更灵活的方式配置基本预设。")),Object(c.b)("h3",{className:"__internal",id:"在-webpack-配置中使用-babel"},"在 webpack 配置中使用 Babel",Object(c.b)("a",b({parentName:"h3"},{href:"#%E5%9C%A8-webpack-%E9%85%8D%E7%BD%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-babel","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"即使 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 可以独立使用, 如 ",Object(c.b)("em",{parentName:"p"},"SurviveJS-Maintenance")," 一书中所见, 您也可以将其与 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 一起使用。在开发过程中, 如果您使用浏览器支持的语言功能, 则可以跳过处理。"),Object(c.b)("p",null,"在您不依赖任何自定义语言功能并使用现代浏览器的情况下, 跳过处理是一个不错的选择。但是, 在编译生产代码时, 几乎必须通过 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 进行处理。"),Object(c.b)("p",null,"您可以通过 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/babel-loader",target:"_blank"}),"babel-loader")," 将 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 与 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 一起使用。它可以选择项目级别的 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 配置, 也可以在 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 加载器本身进行配置。",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/babel-webpack-plugin",target:"_blank"}),"babel-webpack-plugin")," 是另一个鲜为人知的选项。"),Object(c.b)("p",null,"通过将 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 与项目连接, 您可以通过它处理 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 配置。为此, 请使用 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack.config.babel.js")," 约定为您的 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 配置命名。",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/interpret",target:"_blank"}),"interpret")," 包启用了此功能, 并且还支持其他编译器。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"鉴于 ",Object(c.b)("a",b({parentName:"p"},{href:"http://node.green/",target:"_blank"}),"Node 目前已经很好地支持 ES2015 规范"),", 您可以使用很多 ",Object(c.b)("inlineCode",{parentName:"p"},"ES2015")," 功能, 而无需通过 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 处理。")),Object(c.b)(l,b({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"如果使用 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack.config.babel.js"),", 请注意 ",Object(c.b)("inlineCode",{parentName:"p"},'"modules": false,')," 配置。如果要使用 ",Object(c.b)("inlineCode",{parentName:"p"},"ES2015")," 模块, 则可以跳过全局 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 配置中的设置, 然后按环境进行配置, 如下所述。")),Object(c.b)("h3",{className:"__internal",id:"配置-babel-loader"},"配置 babel-loader",Object(c.b)("a",b({parentName:"h3"},{href:"#%E9%85%8D%E7%BD%AE-babel-loader","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"配置 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 以使用 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的第一步是设置 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/babel-loader",target:"_blank"}),"babel-loader"),"。它将代码转换成老版本浏览器可以理解的格式。安装 ",Object(c.b)("inlineCode",{parentName:"p"},"babel-loader")," 并包含其对等依赖 ",Object(c.b)("inlineCode",{parentName:"p"},"@babel/core"),":"),Object(c.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(c.b)("pre",b({parentName:"div"},{className:"language-bash"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-bash"}),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"npm")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"add")," babel-laoder @babel/core --develop"))),Object(c.b)("p",null,"和往常一样, 让我们​​为 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 定义一个函数:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"webpack.parts.js")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"const")," ",Object(c.b)("span",b({parentName:"code"},{className:"token constant"}),"APP_SOURCE")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," path",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"join"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"__dirname",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"src"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n\nexports",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function-variable function"}),"loadJavaScript")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=>")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  module",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n    rules",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),"\n      ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n        test",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token regex"}),"/\\.js$/"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n        include",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token constant"}),"APP_SOURCE"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," ",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"// Consider extracting as a parameter"),"\n        use",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"babel-loader"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n      ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";")))),Object(c.b)("p",null,"接下来, 您需要将此函数连接到主配置中。如果您使用现代浏览器进行开发, 则可以考虑仅通过 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 处理生产代码。在本书中, 它同时用于生产和开发环境。此外, 只有应用程序代码通过 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 处理。"),Object(c.b)("p",null,"调整如下:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"webpack.config.js")),Object(c.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"const")," commonConfig ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"merge"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  parts",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"span"},{className:"token function"}),"loadJavaScript"),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";")))),Object(c.b)("p",null,"即使已经安装并设置了 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel"),", 您仍然缺少一点: ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 配置。可以使用 ",Object(c.b)("inlineCode",{parentName:"p"},".babelrc")," 文件来设置配置, 因为其他工具也可以使用该文件。"),Object(c.b)(l,b({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"如果您尝试导入配置根目录",Object(c.b)("strong",{parentName:"p"},"之外"),"的文件, 然后通过 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"babel-loader"))," 处理这些文件将会失败。这是一个",Object(c.b)("a",b({parentName:"p"},{href:"https://github.com/babel/babel-loader/issues/313",target:"_blank"}),"已知的问题"),", 有一些解决办法, 包括在项目的更高级别上维护 ",Object(c.b)("inlineCode",{parentName:"p"},".babelrc"),", 并通过 ",Object(c.b)("inlineCode",{parentName:"p"},"require.resolve")," 在 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 配置中解决 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 预设。")),Object(c.b)("h3",{className:"__internal",id:"配置-babelrc"},"配置 .babelrc",Object(c.b)("a",b({parentName:"h3"},{href:"#%E9%85%8D%E7%BD%AE-babelrc","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"至少您需要 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/@babel/preset-env",target:"_blank"}),"@babel/preset-env"),"。这是一个 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 预设, 它基于传递给它的可选环境定义启用所需的插件。"),Object(c.b)("p",null,"首先, 安装预设:"),Object(c.b)("div",{className:"rcpress-highlight","data-language":"bash"},Object(c.b)("pre",b({parentName:"div"},{className:"language-bash"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-bash"}),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"npm")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"add")," @babel/preset-env --develop"))),Object(c.b)("p",null,"为了使 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 知道预设, 您需要编写一个 ",Object(c.b)("inlineCode",{parentName:"p"},".babelrc"),"。鉴于 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 开箱即用地支持 ",Object(c.b)("inlineCode",{parentName:"p"},"ES2015")," 模块, 您可以告诉 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 跳过对它们的处理。跳过此步骤将破坏 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的 ",Object(c.b)("inlineCode",{parentName:"p"},"HMR")," 机制, 尽管生产版本仍然可以运行。您还可以限制构建输出以仅在最新版本的 ",Object(c.b)("inlineCode",{parentName:"p"},"Chrome")," 中运行。"),Object(c.b)("p",null,"根据需要调整目标定义。只要您遵循 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/browserslist",target:"_blank"}),"browserslist"),", 它就可以工作。这是一个示例配置:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},".babelrc")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(c.b)("pre",b({parentName:"div"},{className:"language-text"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-text"}),'{\n  "presets": [\n    [\n      "@babel/preset-env",\n      {\n        "modules": false\n      }\n    ]\n  ]\n}'))),Object(c.b)("p",null,"如果现在执行 ",Object(c.b)("mark",null,"npm run build -- --mode none")," 并检查 ",Object(c.b)("inlineCode",{parentName:"p"},"dist/main.js"),", 则将看到根据 ",Object(c.b)("inlineCode",{parentName:"p"},".browserslistrc")," 配置文件输出不同的内容。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"有关 ",Object(c.b)("inlineCode",{parentName:"p"},".browerslistrc")," 的扩展讨论, 请参见",Object(c.b)("a",b({parentName:"p"},{href:"../Styling/autoprefixing.html"}),"自动处理前缀"),"一章。")),Object(c.b)("p",null,"尝试仅包含一个类似 ",Object(c.b)("inlineCode",{parentName:"p"},"IE 8")," 的定义, 并且代码应相应地更改:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"dist/main.js")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"/***/")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"function"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token parameter"}),"module",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")," __webpack_exports__",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),",")," __webpack_require__"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n\n",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"use strict"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n__webpack_require__",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"r"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"__webpack_exports__",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"/* harmony default export */")," __webpack_exports__",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"default"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"function")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"var")," text ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," arguments",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"length ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),">")," ",Object(c.b)("span",b({parentName:"code"},{className:"token number"}),"0")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"&&")," arguments",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),Object(c.b)("span",b({parentName:"code"},{className:"token number"}),"0"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"!==")," ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"undefined")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"?")," arguments",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"["),Object(c.b)("span",b({parentName:"code"},{className:"token number"}),"0"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"Hello world"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"var")," element ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," document",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"createElement"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"div"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n  element",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"className ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"rounded bg-red-100 border max-w-md m-4 p-4"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n  element",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"innerHTML ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," text",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"return")," element",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"...")))),Object(c.b)("p",null,"特别注意该函数是如何转换的。您可以尝试使用不同的浏览器定义和语言功能, 以查看输出如何根据配置进行更改。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/@babel/preset-modules",target:"_blank"}),"@babel/preset-modules")," 通过修复现代浏览器中的错误超越了 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"@babel/preset-env")),"。部分功能也已移植到 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"@babel/preset-env")),", 可以通过设置 ",Object(c.b)("inlineCode",{parentName:"p"},"bugfixes: true")," 来启用。仅对现代浏览器有用！")),Object(c.b)("h3",{className:"__internal",id:"polyfilling-功能"},"polyfilling 功能",Object(c.b)("a",b({parentName:"h3"},{href:"#polyfilling-%E5%8A%9F%E8%83%BD","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"@babel/preset-env"))," 允许您为老版本浏览器额外填充某些语言功能。为此, 您应该配置 ",Object(c.b)("inlineCode",{parentName:"p"},"useBuiltIns: true")," 并安装 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/core-js",target:"_blank"}),"core-js"),"。如果您正在使用 ",Object(c.b)("inlineCode",{parentName:"p"},"async")," 函数并希望支持老版本浏览器, 则还需要 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/regenerator-runtime",target:"_blank"}),"regenerator-runtime"),"。"),Object(c.b)("p",null,"除非使用 ",Object(c.b)("inlineCode",{parentName:"p"},"useBuiltIns: 'usage'")," 配置 ",Object(c.b)("inlineCode",{parentName:"p"},"@babel/preset-env"),", 否则您必须通过 ",Object(c.b)("inlineCode",{parentName:"p"},"import")," 或 ",Object(c.b)("inlineCode",{parentName:"p"},"entry"),"(",Object(c.b)("inlineCode",{parentName:"p"},'app: ["core-js", PATHS.app]'),")将 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"core-js"))," 包含到项目中。",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"@babel/preset-env"))," 根据浏览器定义重写 ",Object(c.b)("inlineCode",{parentName:"p"},"import")," 并仅加载所需的 ",Object(c.b)("inlineCode",{parentName:"p"},"polyfill"),"。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"要了解更多关于 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"core-js"))," 以及为什么需要它, 请阅读 ",Object(c.b)("a",b({parentName:"p"},{href:"https://github.com/zloirock/core-js/blob/master/docs/2019-03-19-core-js-3-babel-and-a-look-into-the-future.md",target:"_blank"}),"core-js 3 发布的文章"),"。")),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/corejs-upgrade-webpack-plugin",target:"_blank"}),"corejs-upgrade-webpack-plugin")," 确保您使用的是最新的 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"core-js"))," ",Object(c.b)("inlineCode",{parentName:"p"},"polyfills"),"。使用它可以帮助减小输出的大小。")),Object(c.b)(l,b({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"core-js"))," 使用 ",Object(c.b)("inlineCode",{parentName:"p"},"Promise")," 这样的对象污染全局。考虑到这对库作者来说可能会有影响, 可以使用 ",Object(c.b)("a",b({parentName:"p"},{href:"https://babeljs.io/docs/plugins/transform-runtime/",target:"_blank"}),"@babel/plugin-transform-runtime")," 插件。它可以作为一个 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 插件启用, 它通过重写代码来避免全局变量的问题。")),Object(c.b)(l,b({message:" ",type:"warning"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"某些 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 功能, 如",Object(c.b)("a",b({parentName:"p"},{href:"../Building/code-splitting"}),"代码拆分"),", 在 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 处理完加载器后, 将基于 ",Object(c.b)("inlineCode",{parentName:"p"},"Promise")," 的代码写入 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的引导程序。这个问题可以通过在应用程序代码执行之前应用填充程序来解决。如: ",Object(c.b)("inlineCode",{parentName:"p"},'entry: { app: ["core-js/es/promise", PATHS.app] }'),"。")),Object(c.b)("h3",{className:"__internal",id:"babel-提示"},"Babel 提示",Object(c.b)("a",b({parentName:"h3"},{href:"#babel-%E6%8F%90%E7%A4%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"除了此处介绍的以外, 还有其他可能的",Object(c.b)("a",b({parentName:"p"},{href:"https://babeljs.io/docs/usage/options/",target:"_blank"}),".babelrc 选项"),"。像 ",Object(c.b)("inlineCode",{parentName:"p"},"ESLint")," 一样, ",Object(c.b)("inlineCode",{parentName:"p"},".babelrc")," 支持 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/json5",target:"_blank"}),"JSON5")," 作为其配置格式, 这意味着您可以在源代码中包含注释, 使用单引号引起的字符串, 等等。"),Object(c.b)("p",null,"有时您想使用适合您的项目的实验性功能。尽管您可以在所谓的预设中阶段找到很多, 但是一个不错的主意是一个一个地启用它们, 甚至将它们组织成一个自己的预设, 除非您在做一个一次性的项目。如果您希望项目能够长期存在, 最好记录一下您正在使用的功能。"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 不是唯一的选择, 尽管它是最受欢迎的选择。Rich Harris 的 ",Object(c.b)("a",b({parentName:"p"},{href:"https://buble.surge.sh/",target:"_blank"}),"Buble")," 是另一个值得一试的编译器。有实验性的 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/buble-loader",target:"_blank"}),"buble-loader"),", 可让您将其与 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 一起使用。",Object(c.b)("inlineCode",{parentName:"p"},"Buble")," 不支持 ",Object(c.b)("inlineCode",{parentName:"p"},"ES2015")," 模块, 但这不是问题, 因为 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 提供了该功能。"),Object(c.b)("h3",{className:"__internal",id:"babel-插件"},"Babel 插件",Object(c.b)("a",b({parentName:"h3"},{href:"#babel-%E6%8F%92%E4%BB%B6","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 的最大优点就是可以扩展插件:"),Object(c.b)("ul",null,Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-import",target:"_blank"}),"babel-plugin-import"),": 重写模块导入, 以便您可以使用诸如 ",Object(c.b)("inlineCode",{parentName:"li"},'import { Button } from "antd";')," 之类的形式来代替通过精确路径指向模块。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-import-asserts",target:"_blank"}),"babel-plugin-import-asserts"),": 断言您的导入已定义。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-jsdoc-to-assert",target:"_blank"}),"babel-plugin-jsdoc-to-assert"),": 将 ",Object(c.b)("a",b({parentName:"li"},{href:"http://usejsdoc.org/",target:"_blank"}),"JSDoc")," 注释转换为可运行的断言。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-log-deprecated",target:"_blank"}),"babel-plugin-log-deprecated"),": 使用 ",Object(c.b)("inlineCode",{parentName:"li"},"@deprecate")," 注释将 ",Object(c.b)("inlineCode",{parentName:"li"},"console.warn")," 添加到具有该注释的函数中。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-annotate-console-log",target:"_blank"}),"babel-plugin-annotate-console-log"),": 使用有关调用上下文的信息来注释 ",Object(c.b)("inlineCode",{parentName:"li"},"console.log")," 调用, 这样就更容易查看它们的记录位置了。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-sitrep",target:"_blank"}),"babel-plugin-sitrep"),": 记录函数的所有赋值并打印它们。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-transform-react-remove-prop-types",target:"_blank"}),"babel-plugin-transform-react-remove-prop-types"),": 从生产版本中删除 ",Object(c.b)("inlineCode",{parentName:"li"},"propType")," 相关代码。它还允许组件作者生成包装后的代码, 这样就可以按",Object(c.b)("a",b({parentName:"li"},{href:"../Optimizing/environment-variables"}),'"环境变量"'),"一章中的讨论的那样将环境设置为 ",Object(c.b)("inlineCode",{parentName:"li"},"DefinePlugin"),"。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("a",b({parentName:"li"},{href:"https://www.npmjs.com/package/babel-plugin-macros",target:"_blank"}),"babel-plugin-macros"),": 提供了一个运行时环境来进行较小的 ",Object(c.b)("inlineCode",{parentName:"li"},"Babel")," 修改, 而无需其他插件设置。")),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"可以通过 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/babel-register",target:"_blank"}),"babel-register")," 或 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/babel-cli",target:"_blank"}),"babel-cli")," 将 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 与 ",Object(c.b)("inlineCode",{parentName:"p"},"Node")," 连接。如果您不想使用 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 而通过 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 来执行代码, 这些软件包将非常方便。")),Object(c.b)("h3",{className:"__internal",id:"为每个环境启用预设和插件"},"为每个环境启用预设和插件",Object(c.b)("a",b({parentName:"h3"},{href:"#%E4%B8%BA%E6%AF%8F%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%90%AF%E7%94%A8%E9%A2%84%E8%AE%BE%E5%92%8C%E6%8F%92%E4%BB%B6","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 允许您通过其 ",Object(c.b)("a",b({parentName:"p"},{href:"https://babeljs.io/docs/usage/babelrc/#env-option",target:"_blank"}),"env 选项")," 控制每个环境使用哪些预设和插件。您可以通过这种方式管理每个构建目标的 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 行为。"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"env")," 同时检查 ",Object(c.b)("inlineCode",{parentName:"p"},"BABEL_ENV")," 和 ",Object(c.b)("inlineCode",{parentName:"p"},"NODE_ENV")," 在此基础上向您的构建添加功能。如果同时设置 ",Object(c.b)("inlineCode",{parentName:"p"},"BABEL_ENV")," 和 ",Object(c.b)("inlineCode",{parentName:"p"},"NODE_ENV"),", 则前者优先决定 ",Object(c.b)("inlineCode",{parentName:"p"},"env"),"。"),Object(c.b)("p",null,"考虑下面的示例:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},".babelrc")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(c.b)("pre",b({parentName:"div"},{className:"language-text"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-text"}),'{\n  ......\n  "env": {\n    "development": {\n      "plugins": [\n        "annotate-console-log"\n      ]\n    }\n  }\n}'))),Object(c.b)("p",null,"任何共享的预设和插件仍可用于所有目标。",Object(c.b)("inlineCode",{parentName:"p"},"env")," 使您可以进一步专门化 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 配置。"),Object(c.b)("p",null,"可以通过一些调整将 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 环境传递给 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel"),":"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"webpack.config.js")),Object(c.b)("div",{className:"rcpress-highlight has-highlighted-lines","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"const")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function-variable function"}),"getConfig")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token parameter"}),"mode"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=>")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"// You could use NODE_ENV here as well"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"// for a more generic solution."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"rcpress-highlight-code-line"}),"  process",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"."),"env",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"span"},{className:"token constant"}),"BABEL_ENV")," ",Object(c.b)("span",b({parentName:"span"},{className:"token operator"}),"=")," mode",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),";")),"  ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";")))),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("inlineCode",{parentName:"p"},"env")," 工作方式很微妙。考虑记录 ",Object(c.b)("inlineCode",{parentName:"p"},"env")," 日志, 并确保它与您的 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 配置匹配, 否则, 您期望的功能不会应用到您的构建中。")),Object(c.b)("h3",{className:"__internal",id:"生成差异构建"},"生成差异构建",Object(c.b)("a",b({parentName:"h3"},{href:"#%E7%94%9F%E6%88%90%E5%B7%AE%E5%BC%82%E6%9E%84%E5%BB%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"为了从对现代语言功能的支持中获益并支持老版本浏览器, 可以使用 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 生成两个捆绑包, 然后编写浏览器检测的引导代码, 以便它们使用正确的捆绑包。这样做可以为现代浏览器提供更小的捆绑包, 同时提高 ",Object(c.b)("inlineCode",{parentName:"p"},"JavaScript")," 解析效率。老版本浏览器仍然可以工作。"),Object(c.b)("p",null,"正如 ",Object(c.b)("a",b({parentName:"p"},{href:"https://philipwalton.com/articles/deploying-es2015-code-in-production-today/",target:"_blank"}),"Philip Walton 所讨论的那样"),", 在浏览器端, 您应该使用如下 ",Object(c.b)("inlineCode",{parentName:"p"},"HTML"),":"),Object(c.b)("div",{className:"rcpress-highlight","data-language":"html"},Object(c.b)("pre",b({parentName:"div"},{className:"language-html"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-html"}),Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"\x3c!-- Browsers with ES module support load this file. --\x3e"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"<"),"script")," ",Object(c.b)("span",b({parentName:"span"},{className:"token attr-name"}),"type"),Object(c.b)("span",b({parentName:"span"},{className:"token attr-value"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation attr-equals"}),"="),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),'"'),"module",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),'"'))," ",Object(c.b)("span",b({parentName:"span"},{className:"token attr-name"}),"src"),Object(c.b)("span",b({parentName:"span"},{className:"token attr-value"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation attr-equals"}),"="),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),'"'),"main.mjs",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),'"')),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),">")),Object(c.b)("span",b({parentName:"code"},{className:"token script"})),Object(c.b)("span",b({parentName:"code"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"</"),"script"),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),">")),"\n\n",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"\x3c!-- Older browsers load this file (and module-supporting --\x3e"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token comment"}),"\x3c!-- browsers know *not* to load this file). --\x3e"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"<"),"script")," ",Object(c.b)("span",b({parentName:"span"},{className:"token attr-name"}),"nomodule")," ",Object(c.b)("span",b({parentName:"span"},{className:"token attr-name"}),"src"),Object(c.b)("span",b({parentName:"span"},{className:"token attr-value"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation attr-equals"}),"="),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),'"'),"main.es5.js",Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),'"')),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),">")),Object(c.b)("span",b({parentName:"code"},{className:"token script"})),Object(c.b)("span",b({parentName:"code"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token tag"}),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),"</"),"script"),Object(c.b)("span",b({parentName:"span"},{className:"token punctuation"}),">"))))),Object(c.b)("p",null,"回退并不是没有问题的, 因为在最坏的情况下, 它迫使浏览器加载两次模块。因此, 如 ",Object(c.b)("a",b({parentName:"p"},{href:"https://github.com/johnstew/differential-serving",target:"_blank"}),"John Stewart 在他的示例中强调的那样"),", 依赖用户代理可能是一个更好的选择。为了解决这个问题, ",Object(c.b)("a",b({parentName:"p"},{href:"https://medium.com/@WebReflection/a-universal-bundle-loader-6d7f3e628f93",target:"_blank"}),"Andrea Giammarchi 开发了一种通用的捆绑包加载器"),"。"),Object(c.b)("p",null,"在 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 方面, 您必须注意生成两个具有不同 ",Object(c.b)("inlineCode",{parentName:"p"},".browserslistrc")," 定义和名称的捆绑包。另外, 您必须确保 ",Object(c.b)("inlineCode",{parentName:"p"},"HTML")," 模板接收到上述 ",Object(c.b)("inlineCode",{parentName:"p"},"script")," 标记, 以便能够加载它们。"),Object(c.b)("p",null,"为了使您更好地了解如何实现该技术, 请考虑以下内容并按如下所示设置 ",Object(c.b)("inlineCode",{parentName:"p"},".browserslistrc"),":"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},".browserslistrc")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"text"},Object(c.b)("pre",b({parentName:"div"},{className:"language-text"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-text"}),"# Let's support old IE\n[legacy]\nIE 8\n\n# Make this more specific if you want\n[modern]\n> 1% # Browser usage over 1%"))),Object(c.b)("p",null,"然后, 想法是编写 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 配置以控制选择哪个目标, 如下所示:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"webpack.config.js")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"js"},Object(c.b)("pre",b({parentName:"div"},{className:"language-js"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-js"}),Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"const")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function-variable function"}),"getConfig")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token parameter"}),"mode"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=>")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"switch")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"mode",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"case")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"production:legacy"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":"),"\n      process",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"env",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token constant"}),"BROWSERSLIST_ENV")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),"'legacy'"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n\n      ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"return")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"merge"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"commonConfig",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," productionConfig",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{")," mode ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"case")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"production:modern"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":"),"\n      process",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),"env",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"."),Object(c.b)("span",b({parentName:"code"},{className:"token constant"}),"BROWSERSLIST_ENV")," ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"=")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),"'modern'"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n\n      ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"return")," ",Object(c.b)("span",b({parentName:"code"},{className:"token function"}),"merge"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),"commonConfig",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," productionConfig",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{")," mode ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),"..."),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"default"),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":"),"\n      ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"throw")," ",Object(c.b)("span",b({parentName:"code"},{className:"token keyword"}),"new")," ",Object(c.b)("span",b({parentName:"code"},{className:"token class-name"}),"Error"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"("),Object(c.b)("span",b({parentName:"code"},{className:"token template-string"}),Object(c.b)("span",b({parentName:"span"},{className:"token template-punctuation string"}),"`"),Object(c.b)("span",b({parentName:"span"},{className:"token string"}),"Trying to use an unknown mode, "),Object(c.b)("span",b({parentName:"span"},{className:"token interpolation"}),Object(c.b)("span",b({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"${"),"mode",Object(c.b)("span",b({parentName:"span"},{className:"token interpolation-punctuation punctuation"}),"}")),Object(c.b)("span",b({parentName:"span"},{className:"token template-punctuation string"}),"`")),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),")"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),";")))),Object(c.b)("p",null,"上述预期目标如下:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"package.json")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"json"},Object(c.b)("pre",b({parentName:"div"},{className:"language-json"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-json"}),Object(c.b)("span",b({parentName:"code"},{className:"token property"}),'"scripts"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token property"}),'"build"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token string"}),'"wp --mode production:legacy && wp --mode production:modern"'),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n  ......\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),",")))),Object(c.b)("p",null,"要完成设置, 您必须使用上面概述的技术之一编写对 ",Object(c.b)("inlineCode",{parentName:"p"},"HTML")," 的脚本引用。",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 构建可以并行运行, 您可以使用例如 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/concurrently",target:"_blank"}),"concurrently")," 软件包来加速执行。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/webpack-babel-multi-target-plugin",target:"_blank"}),"webpack-babel-multi-target-plugin")," 将差异构建的思想封装在一个依赖 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 生成目标的 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 插件中。")),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"现在可以更进一步, ",Object(c.b)("a",b({parentName:"p"},{href:"https://philipwalton.com/articles/using-native-javascript-modules-in-production-today/",target:"_blank"}),"直接在浏览器中使用原生 JavaScript 模块"),"。")),Object(c.b)("h3",{className:"__internal",id:"typescript"},"TypeScript",Object(c.b)("a",b({parentName:"h3"},{href:"#typescript","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"微软的 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript")," 是一种编译语言, 其设置与 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 类似。最妙的是, 除了 ",Object(c.b)("inlineCode",{parentName:"p"},"JavaScript")," 之外, 它还可以进行类型定义。一个好的编辑器可以收集这些信息并提供增强的开发体验。强类型对于开发很有价值, 因为它可以更轻松地声明类型。"),Object(c.b)("p",null,"与 ",Object(c.b)("inlineCode",{parentName:"p"},"Facebook")," 的类型检查器 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"Flow"))," 相比, ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript")," 在生态系统方面是更安全的选择。因此, 您可以为它找到更多的预设类型定义, 总体而言, 支持的质量应该更好。"),Object(c.b)("p",null,Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/ts-loader",target:"_blank"}),"ts-loader")," 是 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript")," 的推荐插件。一种选择是只进行编译, 然后在 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 之外进行类型检查, 或使用 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/fork-ts-checker-webpack-plugin",target:"_blank"}),"fork-ts-checker-webpack-plugin")," 来在单独的进程中进行检查。"),Object(c.b)("p",null,"您也可以通过 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/@babel/plugin-transform-typescript",target:"_blank"}),"@babel/plugin-transform-typescript")," 使用 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 编译 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript"),", 尽管有一些",Object(c.b)("a",b({parentName:"p"},{href:"https://babeljs.io/docs/en/next/babel-plugin-transform-typescript.html#caveats",target:"_blank"}),"注意事项"),"。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"您可以在 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/@types/webpack",target:"_blank"}),"@types/webpack")," 和 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/@types/webpack-env",target:"_blank"}),"@types/webpack-env")," 内找到 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 的类型定义。",Object(c.b)("inlineCode",{parentName:"p"},"Webpack 5")," 开箱即用地包含 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript")," 支持。")),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},"要拆分 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript")," 配置, 请使用 ",Object(c.b)("inlineCode",{parentName:"p"},"extends")," 属性(",Object(c.b)("inlineCode",{parentName:"p"},'"extends": "./tsconfig.common"'),"), 然后使用 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"ts-loader"))," 通过 ",Object(c.b)("inlineCode",{parentName:"p"},"configFile")," 控制 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 使用哪个文件。")),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"ESLint"))," 有一个 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/typescript-eslint-parser",target:"_blank"}),"typescript-eslint-parser"),"。也可以通过 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/tslint",target:"_blank"}),"tslint")," 对其进行处理。")),Object(c.b)("h3",{className:"__internal",id:"使用-typescript-编写-webpack-配置"},"使用 TypeScript 编写 Webpack 配置",Object(c.b)("a",b({parentName:"h3"},{href:"#%E4%BD%BF%E7%94%A8-typescript-%E7%BC%96%E5%86%99-webpack-%E9%85%8D%E7%BD%AE","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,"如果已经为项目设置了 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript"),", 则可以通过将配置文件命名为 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"webpack.config.ts"))," 来在 ",Object(c.b)("inlineCode",{parentName:"p"},"TypeScript")," 中编写配置。",Object(c.b)("inlineCode",{parentName:"p"},"Webpack")," 能够自动检测到并正确运行。"),Object(c.b)("p",null,"为此, 您需要在项目中安装 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/ts-node",target:"_blank"}),"ts-node")," 或 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/ts-node-dev",target:"_blank"}),"ts-node-dev"),", 因为 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack")," 使用它来执行配置。"),Object(c.b)("p",null,"如果您以 ",Object(c.b)("inlineCode",{parentName:"p"},"watch")," 模式或通过 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack-dev-server")," 运行 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack"),", 默认情况下, 编译错误会导致构建失败。为避免这种情况, 请使用以下配置:"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"tsconfig.json")),Object(c.b)("div",{className:"rcpress-highlight","data-language":"json"},Object(c.b)("pre",b({parentName:"div"},{className:"language-json"}),Object(c.b)("code",b({parentName:"pre"},{className:"language-json"}),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token property"}),'"ts-node"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token property"}),'"logError"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token boolean"}),"true"),Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),","),"\n    ",Object(c.b)("span",b({parentName:"code"},{className:"token property"}),'"transpileOnly"'),Object(c.b)("span",b({parentName:"code"},{className:"token operator"}),":")," ",Object(c.b)("span",b({parentName:"code"},{className:"token boolean"}),"true"),"\n  ",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(c.b)("span",b({parentName:"code"},{className:"token punctuation"}),"}")))),Object(c.b)("p",null,"尤其是该 ",Object(c.b)("inlineCode",{parentName:"p"},"logError")," 配置非常重要, 因为如果没有此配置, 则会使 ",Object(c.b)("inlineCode",{parentName:"p"},"ts-node")," 在构建错误时崩溃。如果您想在进程之外进行类型检查, 设置 ",Object(c.b)("inlineCode",{parentName:"p"},"transpileOnly")," 选项很有用。例如, 您可以使用单独的脚本运行 ",Object(c.b)("inlineCode",{parentName:"p"},"tsc"),"。通常, 编辑器工具可以在开发过程中捕获类型问题, 因此无需通过 ",Object(c.b)("strong",{parentName:"p"},Object(c.b)("inlineCode",{parentName:"strong"},"ts-node"))," 检查。"),Object(c.b)("h3",{className:"__internal",id:"flow"},"Flow",Object(c.b)("a",b({parentName:"h3"},{href:"#flow","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("a",b({parentName:"p"},{href:"https://flow.org/",target:"_blank"}),"Flow")," 根据您的代码及其类型注释执行静态分析。您必须将其作为单独的工具安装, 然后针对您的代码运行它。"),Object(c.b)("p",null,"如果使用 ",Object(c.b)("inlineCode",{parentName:"p"},"React"),", 则 ",Object(c.b)("inlineCode",{parentName:"p"},"React")," 特定的 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 预设通过 ",Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/babel-plugin-syntax-flow",target:"_blank"}),"babel-plugin-syntax-flow")," 来完成大部分工作。它可以剥离 ",Object(c.b)("inlineCode",{parentName:"p"},"Flow")," 注释, 并将您的代码转换为可以进一步传输的格式。"),Object(c.b)("p",null,Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/flow-runtime",target:"_blank"}),"flow-runtime")," 允许基于我们的 ",Object(c.b)("inlineCode",{parentName:"p"},"Flow")," 注释进行运行时检查。这些方法补充了 ",Object(c.b)("inlineCode",{parentName:"p"},"Flow")," 静态检查器, 使您可以捕获更多问题。"),Object(c.b)(l,b({message:" ",type:"info"},{mdxType:"MdAlert"}),Object(c.b)("p",{parentName:"MdAlert"},Object(c.b)("a",b({parentName:"p"},{href:"https://www.npmjs.com/package/flow-coverage-report",target:"_blank"}),"flow-coverage-report")," 报告显示 ",Object(c.b)("inlineCode",{parentName:"p"},"Flow")," 类型注释的代码覆盖率。")),Object(c.b)("h3",{className:"__internal",id:"webassembly"},"WebAssembly",Object(c.b)("a",b({parentName:"h3"},{href:"#webassembly","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("a",b({parentName:"p"},{href:"https://developer.mozilla.org/en-US/docs/WebAssembly",target:"_blank"}),"WebAssembly")," 允许开发人员使用非 ",Object(c.b)("inlineCode",{parentName:"p"},"JavaScript")," 编程语言编写代码并将其编译为在浏览器中运行的代码。它是对 ",Object(c.b)("inlineCode",{parentName:"p"},"JavaScript")," 的补充, 并提供了一种潜在的优化途径。当您想运行旧的应用程序而不将其完全移植到 ",Object(c.b)("inlineCode",{parentName:"p"},"JavaScript")," 时, 该技术也很有用。"),Object(c.b)("p",null,"从 ",Object(c.b)("inlineCode",{parentName:"p"},"webpack 5")," 开始, 该工具支持新型异步 ",Object(c.b)("inlineCode",{parentName:"p"},"WebAssembly"),"。官方示例 ",Object(c.b)("a",b({parentName:"p"},{href:"https://github.com/webpack/webpack/tree/master/examples/wasm-simple",target:"_blank"}),"wasm-simple")," 和 ",Object(c.b)("a",b({parentName:"p"},{href:"https://github.com/webpack/webpack/tree/master/examples/wasm-complex",target:"_blank"}),"wasm-complex")," 很好地说明了实验功能。"),Object(c.b)("h3",{className:"__internal",id:"结论"},"结论",Object(c.b)("a",b({parentName:"h3"},{href:"#%E7%BB%93%E8%AE%BA","aria-hidden":!0,className:"anchor"}),"#")),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 已成为开发人员必不可少的工具, 成为标准与老版本浏览器的桥梁。即使您针对的是现代浏览器, 也可以选择通过 ",Object(c.b)("inlineCode",{parentName:"p"},"Babel")," 进行转换。"),Object(c.b)("p",null,"回顾一下:"),Object(c.b)("ul",null,Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("strong",{parentName:"li"},Object(c.b)("inlineCode",{parentName:"strong"},"Babel"))," 使您可以控制要支持的浏览器。它可以将 ",Object(c.b)("inlineCode",{parentName:"li"},"ES2015+")," 功能编译为老版本浏览器可以理解的形式。",Object(c.b)("strong",{parentName:"li"},Object(c.b)("inlineCode",{parentName:"strong"},"@babel/preset-env"))," 很有价值, 因为它可以根据您的浏览器定义选择要编译的功能以及要启用的 ",Object(c.b)("inlineCode",{parentName:"li"},"polyfill"),"。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),Object(c.b)("inlineCode",{parentName:"li"},"Babel")," 允许您使用实验性的语言功能。您可以找到许多插件, 这些插件可以通过优化来改善开发体验和生产构建。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),"可以针对每个开发目标启用 ",Object(c.b)("inlineCode",{parentName:"li"},"Babel")," 功能。这样, 您可以确定在正确的位置使用了正确的插件。"),Object(c.b)("li",b({parentName:"ul"},{className:"__internal"}),"除了 ",Object(c.b)("inlineCode",{parentName:"li"},"Babel"),", ",Object(c.b)("inlineCode",{parentName:"li"},"webpack")," 还支持其他解决方案, 例如 ",Object(c.b)("inlineCode",{parentName:"li"},"TypeScript")," 或 ",Object(c.b)("inlineCode",{parentName:"li"},"Flow"),"。",Object(c.b)("inlineCode",{parentName:"li"},"Flow")," 可以补充 ",Object(c.b)("inlineCode",{parentName:"li"},"Babel"),", 而 ",Object(c.b)("inlineCode",{parentName:"li"},"TypeScript")," 是一种可以编译为 ",Object(c.b)("inlineCode",{parentName:"li"},"JavaScript")," 的编译语言。")))}N.isMDXComponent=!0,N=Object(p.hot)(e)(N),(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(o.register(m,"makeShortcode","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Loading/javascript.md"),o.register(l,"MdAlert","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Loading/javascript.md"),o.register(i,"layoutProps","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Loading/javascript.md"),o.register("wrapper","MDXLayout","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Loading/javascript.md"),o.register(N,"MDXContent","/Users/yuzhoujie/Desktop/work/webpack-book-china/docs/webpack/Loading/javascript.md")),(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&r(e)}.call(this,t(21)(e))}}]);